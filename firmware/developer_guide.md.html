<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><title>Chromium OS Docs - Chromium OS Developer Guide</title><link rel="stylesheet" type="text/css" href="/+static/base.8PwAX-dsywmU2hx_vi_YSA.cache.css"/><link rel="stylesheet" type="text/css" href="/+static/doc.MnCWV4K3oUOUF03WOG9dKw.cache.css"/><link rel="stylesheet" type="text/css" href="/+static/prettify/prettify.pZ5FqzM6cPxAflH0va2Ucw.cache.css"/><!-- default customHeadTagPart --></head><body class="Site"><header class="Site-header Site-header--withNavbar"><div class="Header"><div class="Header-title"><a class="Header-anchor" href="README.md"><img class="Header-anchorLogo" src="https://chromium-review.googlesource.com/plugins/chromium-style/static/chromium_logo.png" alt="project logo"/><span class="Header-anchorTitle">Chromium OS Docs</span></a></div></div><nav class="Header-nav" role="navigation"><ul><li><a href="README.md">Home</a></li><li><a href=".">Sitemap</a></li><li><a href="development_basics.md">Getting Started</a></li><li><a href="developer_guide.md">Developer Guide</a></li><li><a href="contact.md">Contact</a></li><li><a href="reporting_bugs.md">Bugs</a></li><li><a href="https://github.com/google/styleguide/tree/gh-pages/docguide">Style Guide (Markdown)</a></li><li><a href="https://gerrit.googlesource.com/gitiles/+/master/Documentation/markdown.md">Gitiles (Markdown Format)</a></li><li><a href="https://www.chromium.org/chromium-os">Old Docs</a></li></ul></nav></header><div class="Site-content Site-Content--markdown"><div class="Container"><div class="doc"><h1><a class="h" name="Chromium-OS-Developer-Guide" href="#Chromium-OS-Developer-Guide"><span></span></a><a class="h" name="chromium-os-developer-guide" href="#chromium-os-developer-guide"><span></span></a>Chromium OS Developer Guide</h1><h2><a class="h" name="Introduction" href="#Introduction"><span></span></a><a class="h" name="introduction" href="#introduction"><span></span></a>Introduction</h2><p>This guide describes how to work on Chromium OS. If you want to help develop Chromium OS and you&lsquo;re looking for detailed information about how to get started, you&rsquo;re in the right place. You can also use the <a href="https://sites.google.com/a/chromium.org/dev/chromium-os/quick-start-guide">quick-start guide</a> instead, which gives just the basic steps that work for most people.</p><div class="toc" role="navigation"><h2>Contents</h2><div class="toc-aux"><ul><li><a href="#Introduction">Introduction</a></li><ul><li><a href="#Target-audience">Target audience</a></li><li><a href="#Organization-content">Organization &amp; content</a></li><li><a href="#Typography-conventions">Typography conventions</a></li><li><a href="#Modifying-this-document">Modifying this document</a></li><li><a href="#More-information">More information</a></li></ul><li><a href="#Prerequisites">Prerequisites</a></li><ul><li><a href="#Install-git-and-curl">Install git and curl</a></li><li><a href="#Install-depot_tools">Install depot_tools</a></li><li><a href="#Tweak-your-sudoers-configuration">Tweak your sudoers configuration</a></li><li><a href="#Configure-git">Configure git</a></li><li><a href="#Preparations-to-submit-changes">Preparations to submit changes</a></li><li><a href="#Double_check-that-you-are-running-a-64_bit-architecture">Double-check that you are running a 64-bit architecture</a></li><li><a href="#Verify-that-your-default-file-permissions-umask_setting-is-correct">Verify that your default file permissions (umask) setting is correct</a></li></ul><li><a href="#Get-the-Source">Get the Source</a></li><ul><li><a href="#Decide-where-your-source-will-live">Decide where your source will live</a></li><li><a href="#Get-the-source-code">Get the source code</a></li></ul><li><a href="#Building-Chromium-OS">Building Chromium OS</a></li><ul><li><a href="#Create-a-chroot">Create a chroot</a></li><li><a href="#Enter-the-chroot">Enter the chroot</a></li><li><a href="#Select-a-board">Select a board</a></li><li><a href="#Initialize-the-build-for-a-board">Initialize the build for a board</a></li><li><a href="#Set-the-chronos-user-password">Set the chronos user password</a></li><li><a href="#Build-the-packages-for-your-board">Build the packages for your board</a></li><li><a href="#Build-a-disk-image-for-your-board">Build a disk image for your board</a></li><li><a href="#Look-at-your-disk-image-optional">Look at your disk image (optional)</a></li></ul><li><a href="#Installing-Chromium-OS-on-your-Device">Installing Chromium OS on your Device</a></li><ul><li><a href="#Put-your-image-on-a-USB-disk">Put your image on a USB disk</a></li><li><a href="#Disable-verified-boot">Disable verified boot</a></li><li><a href="#Boot-from-your-USB-disk">Boot from your USB disk</a></li><li><a href="#Installing-your-Chromium-OS-image-to-your-hard-disk">Installing your Chromium OS image to your hard disk</a></li><li><a href="#Getting-to-a-command-prompt-on-Chromium-OS">Getting to a command prompt on Chromium OS</a></li><li><a href="#Building-an-image-to-run-in-a-virtual-machine">Building an image to run in a virtual machine</a></li></ul><li><a href="#Making-changes-to-packages-whose-source-code-is-checked-into-Chromium-OS-git-repositories">Making changes to packages whose source code is checked into Chromium OS git repositories</a></li><ul><li><a href="#Keep-the-tree-green">Keep the tree green</a></li><li><a href="#Run-cros_workon-start">Run cros_workon start</a></li><li><a href="#Run-repo-sync">Run repo sync</a></li><li><a href="#Find-out-which-ebuilds-map-to-which-directories">Find out which ebuilds map to which directories</a></li><li><a href="#Create-a-branch-for-your-changes">Create a branch for your changes</a></li><li><a href="#Make-your-changes">Make your changes</a></li><li><a href="#Set-your-editor">Set your editor</a></li><li><a href="#Submit-changes-locally">Submit changes locally</a></li><li><a href="#Upload-your-changes-and-get-a-code-review">Upload your changes and get a code review</a></li><li><a href="#Clean-up-after-you_re-done-with-your-changes">Clean up after you&#39;re done with your changes</a></li></ul><li><a href="#Making-changes-to-non_cros_workon_able-packages">Making changes to non-cros_workon-able packages</a></li><ul><li><a href="#Adding-small-patches-to-existing-packages">Adding small patches to existing packages</a></li><li><a href="#Making-changes-to-the-way-that-the-chroot-is-constructed">Making changes to the way that the chroot is constructed</a></li><li><a href="#Building-an-individual-package">Building an individual package</a></li><li><a href="#Making-changes-to-the-Chromium-web-browser-on-Chromium-OS">Making changes to the Chromium web browser on Chromium OS</a></li></ul><li><a href="#Using-Clang-to-get-better-compiler-diagnostics">Using Clang to get better compiler diagnostics</a></li><ul><li><a href="#Description">Description</a></li><li><a href="#Wrapper-Options">Wrapper Options</a></li><li><a href="#Testing">Testing</a></li></ul><li><a href="#Local-Debugging">Local Debugging</a></li><ul><li><a href="#Debugging-both-x86-and-non_x86-binaries-on-your-workstation">Debugging both x86 and non-x86 binaries on your workstation.</a></li></ul><li><a href="#Remote-Debugging">Remote Debugging</a></li><ul><li><a href="#Setting-up-remote-debugging-by-hand">Setting up remote debugging by hand.</a></li><li><a href="#Automated-remote-debugging-using-gdb_BOARD_script-gdb_lumpy_gdb_daisy_gdb_parrot_etc">Automated remote debugging using gdb-${BOARD} script (gdb-lumpy, gdb-daisy, gdb-parrot, etc).</a></li><li><a href="#Edit_Debug-cycle">Edit/Debug cycle</a></li><li><a href="#Examples-of-debugging-using-the-gdb_BOARD_script">Examples of debugging using the gdb-${BOARD} script.</a></li></ul><li><a href="#Building-Chrome-for-Chromium-OS">Building Chrome for Chromium OS</a></li><li><a href="#Troubleshooting">Troubleshooting</a></li><ul><li><a href="#I-lost-my-developer-tools-on-the-stateful-partition_can-I-get-them-back">I lost my developer tools on the stateful partition, can I get them back?</a></li></ul><li><a href="#Running-Tests">Running Tests</a></li><ul><li><a href="#Tast">Tast</a></li><li><a href="#Autotest">Autotest</a></li><li><a href="#Creating-a-normal-image-that-has-been-modified-for-test">Creating a normal image that has been modified for test</a></li><li><a href="#Creating-a-VM-image-that-has-been-modified-for-test">Creating a VM image that has been modified for test</a></li><li><a href="#Creating-a-recovery-image-that-has-been-modified-for-test">Creating a recovery image that has been modified for test</a></li></ul><li><a href="#Additional-information">Additional information</a></li><ul><li><a href="#Toolchain-Compilers">Toolchain Compilers</a></li><li><a href="#Developer-mode">Developer mode</a></li><li><a href="#Attribution-requirements">Attribution requirements</a></li><li><a href="#Documentation-on-this-site">Documentation on this site</a></li><li><a href="#External-documentation">External documentation</a></li></ul></ul></div></div><h3><a class="h" name="Target-audience" href="#Target-audience"><span></span></a><a class="h" name="target-audience" href="#target-audience"><span></span></a>Target audience</h3><p>The target audience of this guide is anyone who wants to obtain, build, or contribute to Chromium OS. That includes new developers who are interested in the project and who simply want to browse through the Chromium OS code, as well as developers who have been working on Chromium OS for a long time.</p><h3><a class="h" name="Organization-content" href="#Organization-content"><span></span></a><a class="h" name="organization-content" href="#organization-content"><span></span></a>Organization &amp; content</h3><p>This guide describes the common tasks required to develop Chromium OS. The guide is organized linearly, so that developers who are new to Chromium OS can follow the tasks in sequence. The tasks are grouped into the following sections:</p><ul><li><a href="#Prerequisites">Prerequisites</a></li><li><a href="#Getting-the-source-code">Getting the source code</a></li><li><a href="#Building-Chromium-OS">Building Chromium OS</a></li><li><a href="#Installing-Chromium-OS-on-your-Device">Installing Chromium OS on your Device</a></li><li><a href="#Making-changes-to-packages-whose-source-code-is-checked-into-Chromium-OS-git-repositories">Making changes to packages whose source code is checked into Chromium OS git repositories</a></li><li><a href="#Making-changes-to-non-cros_workon-able-packages">Making changes to non-cros_workon-able packages</a></li><li><a href="#Using-Clang-to-get-better-compiler-diagnostics">Using Clang to get better compiler diagnostics</a></li><li><a href="#Local-Debugging">Local Debugging</a></li><li><a href="#Remote-Debugging">Remote Debugging</a></li><li><a href="#Troubleshooting">Troubleshooting</a></li><li><a href="#Running-Tests">Running Tests</a></li><li><a href="#Additional-information">Additional information</a></li></ul><h3><a class="h" name="Typography-conventions" href="#Typography-conventions"><span></span></a><a class="h" name="typography-conventions" href="#typography-conventions"><span></span></a>Typography conventions</h3><ul><li><strong>Commands</strong> are shown with different labels to indicate whether they apply to (1) your build computer (the computer on which you&#39;re doing development), (2) the chroot on your build computer, or (3) your Chromium OS computer (the device on which you run the images you build):</li></ul><table><thead><tr><th>Label</th><th>Commands</th></tr></thead><tbody><tr><td>(outside)</td><td>on your build computer, outside the chroot</td></tr><tr><td>(inside)</td><td>inside the chroot on your build computer</td></tr><tr><td>(device)</td><td>your Chromium OS computer</td></tr></tbody></table><ul><li><strong>Notes</strong> are shown using the following conventions:<ul><li><strong>IMPORTANT NOTE</strong> describes required actions and critical information</li><li><strong>SIDE NOTE</strong> describes explanations, related information, and alternative options</li></ul></li><li><strong>TODO</strong> describes questions or work that is needed on this document</li></ul><h3><a class="h" name="Modifying-this-document" href="#Modifying-this-document"><span></span></a><a class="h" name="modifying-this-document" href="#modifying-this-document"><span></span></a>Modifying this document</h3><p>If you&#39;re a Chromium OS developer, <strong>YOU SHOULD UPDATE THIS DOCUMENT</strong> and fix things as appropriate. See <a href="README.md">README.md</a> for how to update this document. Bias towards action:</p><ul><li>If you see a TODO and you know the right answer, fix it!</li><li>If you see something wrong, fix it.</li><li>If you&lsquo;re not sure of the perfect answer, still fix it. Stick in a TODO noting your uncertainty if you aren&rsquo;t sure, but don&#39;t let anything you know to be wrong stick around.</li></ul><p>Please try to abide by the following guidelines when you modify this document:</p><ul><li>Put all general &ldquo;getting started&rdquo; information directly on this page. It&#39;s OK if this document grows big.</li><li>If some information is also relevant for other documents, put the information in this document and add links from the other documents to this document. If you do not have a choice and must put information relevant to getting started in other documents, add links in this document to discrete chunks of information in the other documents. Following a web of links can be very confusing, especially for people who are new to a project, so it&#39;s very important to maintain a linear flow as much as possible.</li><li>Where possible, describe a single way of doing things. If you specify multiple options, provide a clear explanation why someone following the instructions would pick one option over the others. If there is disagreement about how to do things, consider listing alternative options in a SIDE NOTE.</li><li>Keep Google-specific references to a minimum. A large number of the people working on Chromium OS work at Google, and this document may occasionally contain references that are only relevant to engineers at Google. Google engineers, please keep such references to a minimum – Chromium OS is an open source project that should stay as open as possible.</li></ul><h3><a class="h" name="More-information" href="#More-information"><span></span></a><a class="h" name="more-information" href="#more-information"><span></span></a>More information</h3><p>This document provides an overview of the tasks required to develop Chromium OS. After you&#39;ve learned the basics, check out the links in the <a href="#Additional-information">Additional information</a> section at the end of this document for tips and tricks, FAQs, and important details (e.g., the Chromium OS directory structure, using the dev server, etc.).</p><p>Finally, if you build a Chromium OS image, please read this important note about <a href="#Attribution-requirements">Attribution requirements</a>.</p><h2><a class="h" name="Prerequisites" href="#Prerequisites"><span></span></a><a class="h" name="prerequisites" href="#prerequisites"><span></span></a>Prerequisites</h2><p>You must have Linux to develop Chromium OS. Any recent or up-to-date distribution should work. However, we can&lsquo;t support everyone and their dog&rsquo;s Linux distro, so the only official supported environment is listed below. If you encounter issues with other setups, patches are generally welcomed, but please do not expect us to figure out your distro.</p><ul><li><p><a href="http://www.ubuntu.com/">Ubuntu</a>  Linux (version 14.04 - Trusty)</p><p>Most developers working on Chromium OS are using Trusty (the LTS version of Ubuntu). It is possible that things will work if you&lsquo;re running a different Linux distribution, but you will probably find life easier if you&rsquo;re on this one.</p></li><li><p>an x86_64 64-bit system for performing the build</p></li><li><p>an account with <code class="code">sudo</code> access</p><p>You need root access to run the <code class="code">chroot</code> command and to modify the mount table. <strong>NOTE:</strong> Do not run any of the commands listed in this document as root – the commands themselves will run sudo to get root access when needed.</p></li><li><p>many gigabytes of RAM</p><p>Per <a href="https://groups.google.com/a/chromium.org/d/topic/chromium-os-dev/ZcbP-33Smiw/discussion">this thread</a>, linking Chrome requires somewhere between 8 GB and 28 GB of RAM as of March 2017; you may be able to get by with less at the cost of slower builds with adequate swap space. Seeing an error like <code class="code">error: ld terminated with signal 9 [Killed]</code> while building the <code class="code">chromeos-chrome</code> package indicates that you need more RAM. If you are not building your own copy of Chrome, the RAM requirements will be substantially lower.</p></li></ul><p>You will have a much nicer time if you also have:</p><ul><li><p>a fast multi-processor machine with lots of memory</p><p>The build system is optimized to make good use of all processors, and an 8 core machine will build nearly 8x faster than a single core machine.</p></li><li><p>a good Internet connection</p><p>This will help for the initial download (minimum of about 2 GB) and any further updates.</p></li></ul><h3><a class="h" name="Install-git-and-curl" href="#Install-git-and-curl"><span></span></a><a class="h" name="install-git-and-curl" href="#install-git-and-curl"><span></span></a>Install git and curl</h3><p>Install the git revision control system, the curl download helper, and lvm tools. On Ubuntu, the magic incantation to do this is (all on one line):</p><pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
sudo apt</span><span class="pun">-</span><span class="kwd">get</span><span class="pln"> install git</span><span class="pun">-</span><span class="pln">core gitk git</span><span class="pun">-</span><span class="pln">gui curl lvm2 thin</span><span class="pun">-</span><span class="pln">provisioning</span><span class="pun">-</span><span class="pln">tools \
     python</span><span class="pun">-</span><span class="pln">pkg</span><span class="pun">-</span><span class="pln">resources python</span><span class="pun">-</span><span class="pln">virtualenv python</span><span class="pun">-</span><span class="pln">oauth2client
</span></pre><p>This command also installs git&#39;s graphical front end (<code class="code">git gui</code>) and revision history browser (<code class="code">gitk</code>).</p><h3><a class="h" name="Install-depot_tools" href="#Install-depot_tools"><span></span></a><a class="h" name="install-depot_tools" href="#install-depot_tools"><span></span></a>Install depot_tools</h3><p>To get started, follow the instructions at <a href="http://commondatastorage.googleapis.com/chrome-infra-docs/flat/depot_tools/docs/html/depot_tools_tutorial.html#_setting_up">install depot_tools</a>. This step is required so that you can use the repo command to get/sync the source code.</p><h3><a class="h" name="Tweak-your-sudoers-configuration" href="#Tweak-your-sudoers-configuration"><span></span></a><a class="h" name="tweak-your-sudoers-configuration" href="#tweak-your-sudoers-configuration"><span></span></a>Tweak your sudoers configuration</h3><p>You must tweak your sudoers configuration to turn off the tty_tickets option as described in <a href="http://www.chromium.org/chromium-os/tips-and-tricks-for-chromium-os-developers#TOC-Making-sudo-a-little-more-permissive">Making sudo a little more permissive</a>. This is required for using <code class="code">cros_sdk</code>.</p><h3><a class="h" name="Configure-git" href="#Configure-git"><span></span></a><a class="h" name="configure-git" href="#configure-git"><span></span></a>Configure git</h3><p>Setup git now. If you don&#39;t do this, you may run into errors/issues later. Replace <code class="code">you@example.com</code> and <code class="code">Your Name</code> with your information:</p><pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
git config </span><span class="pun">--</span><span class="kwd">global</span><span class="pln"> user</span><span class="pun">.</span><span class="pln">email </span><span class="str">&quot;you@example.com&quot;</span><span class="pln">
git config </span><span class="pun">--</span><span class="kwd">global</span><span class="pln"> user</span><span class="pun">.</span><span class="pln">name </span><span class="str">&quot;Your Name&quot;</span><span class="pln">
</span></pre><h3><a class="h" name="Preparations-to-submit-changes" href="#Preparations-to-submit-changes"><span></span></a><a class="h" name="preparations-to-submit-changes" href="#preparations-to-submit-changes"><span></span></a>Preparations to submit changes</h3><p><strong>IMPORTANT NOTE:</strong> If you are new to Chromium OS, you can skip this step (go to &ldquo;<a href="#Decide-where-your-source-will-live">Decide where your source will live</a>&rdquo;). This is only for people who wish to make changes to the tree. Remember: anyone can post changes to Gerrit for review.</p><p>Follow the instructions <a href="http://www.chromium.org/chromium-os/developer-guide/gerrit-guide">here</a> to setup your code review account(s) and machine access credentials for the source repos. Remember a @chromium.org account is not required to submit code for review.</p><h3><a class="h" name="Double_check-that-you-are-running-a-64_bit-architecture" href="#Double_check-that-you-are-running-a-64_bit-architecture"><span></span></a><a class="h" name="double_check-that-you-are-running-a-64_bit-architecture" href="#double_check-that-you-are-running-a-64_bit-architecture"><span></span></a>Double-check that you are running a 64-bit architecture</h3><p>Run the following command:</p><pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln"> uname </span><span class="pun">-</span><span class="pln">m
</span></pre><p>You should see the result: <code class="code">x86_64</code></p><p>If you see something else (for example, <code class="code">i686</code>, which means you are on a 32-bit machine or a 64-bit machine running a 32-bit OS) then you won&#39;t be able to build Chromium OS. The project would happily welcome patches to fix this.</p><h3><a class="h" name="Verify-that-your-default-file-permissions-umask_setting-is-correct" href="#Verify-that-your-default-file-permissions-umask_setting-is-correct"><span></span></a><a class="h" name="verify-that-your-default-file-permissions-umask_setting-is-correct" href="#verify-that-your-default-file-permissions-umask_setting-is-correct"><span></span></a>Verify that your default file permissions (umask) setting is correct</h3><p>Sources need to be world-readable to properly function inside the chroot (described later). For that reason, the last digit of your umask should not be higher than 2, eg. &lsquo;002&rsquo; or &lsquo;022&rsquo;. Many distros have this by default, Ubuntu, for instance, does not. It is essential to put the following line into your <code class="code">~/.bashrc</code> file before you checkout or sync your sources.</p><pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln"> umask </span><span class="lit">022</span><span class="pln">
</span></pre><p>You can verify that this works by creating any file and checking if its permissions are correct.</p><pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
touch </span><span class="pun">~/</span><span class="pln">foo
ls </span><span class="pun">-</span><span class="pln">la </span><span class="pun">~/</span><span class="pln">foo
</span><span class="pun">-</span><span class="pln">rw</span><span class="pun">-</span><span class="pln">r</span><span class="pun">--</span><span class="pln">r</span><span class="pun">--</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> user </span><span class="kwd">group</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="lit">2012</span><span class="pun">-</span><span class="lit">08</span><span class="pun">-</span><span class="lit">30</span><span class="pln"> </span><span class="lit">23</span><span class="pun">:</span><span class="lit">09</span><span class="pln"> </span><span class="pun">/</span><span class="pln">home</span><span class="pun">/</span><span class="pln">user</span><span class="pun">/</span><span class="pln">foo
</span></pre><h2><a class="h" name="Get-the-Source" href="#Get-the-Source"><span></span></a><a class="h" name="get-the-source" href="#get-the-source"><span></span></a>Get the Source</h2><h3><a class="h" name="Decide-where-your-source-will-live" href="#Decide-where-your-source-will-live"><span></span></a><a class="h" name="decide-where-your-source-will-live" href="#decide-where-your-source-will-live"><span></span></a>Decide where your source will live</h3><p>Chromium OS developers commonly put their source code in <code class="code">${HOME}/chromiumos</code>. If you feel strongly, put your own source elsewhere, but note that <strong>all commands in this document assume that your source code is in</strong> <code class="code">${HOME}/chromiumos</code>.</p><p>Create the directory for your source code with this command:</p><pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln"> mkdir </span><span class="pun">-</span><span class="pln">p $</span><span class="pun">{</span><span class="pln">HOME</span><span class="pun">}/</span><span class="pln">chromiumos
</span></pre><p><strong>IMPORTANT NOTE:</strong> If your home directory is on NFS, you <strong>must</strong> place your code somewhere else. Not only is it a bad idea to build directly from NFS for performance reasons, but builds won&lsquo;t actually work (builds use sudo, and root doesn&rsquo;t have access to your NFS mount, unless your NFS server has the <code class="code">no_root_squash</code> option). Wherever you place your source, you can still add a symbolic link to it from your home directory (this is suggested), like so:</p><pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
mkdir </span><span class="pun">-</span><span class="pln">p </span><span class="pun">/</span><span class="pln">usr</span><span class="pun">/</span><span class="kwd">local</span><span class="pun">/</span><span class="pln">path</span><span class="pun">/</span><span class="pln">to</span><span class="pun">/</span><span class="pln">source</span><span class="pun">/</span><span class="pln">chromiumos
ln </span><span class="pun">-</span><span class="pln">s </span><span class="pun">/</span><span class="pln">usr</span><span class="pun">/</span><span class="kwd">local</span><span class="pun">/</span><span class="pln">path</span><span class="pun">/</span><span class="pln">to</span><span class="pun">/</span><span class="pln">source</span><span class="pun">/</span><span class="pln">chromiumos $</span><span class="pun">{</span><span class="pln">HOME</span><span class="pun">}/</span><span class="pln">chromiumos
</span></pre><h3><a class="h" name="Get-the-source-code" href="#Get-the-source-code"><span></span></a><a class="h" name="get-the-source-code" href="#get-the-source-code"><span></span></a>Get the source code</h3><p>Chromium OS uses <a href="https://code.google.com/p/git-repo/">repo</a> to sync down source code. <code class="code">repo</code> is a wrapper for the <a href="http://git-scm.com/">git</a> that helps deal with a large number of <code class="code">git</code> repositories. You already installed <code class="code">repo</code> when you <a href="http://commondatastorage.googleapis.com/chrome-infra-docs/flat/depot_tools/docs/html/depot_tools_tutorial.html#_setting_up">installed <code class="code">depot_tools</code> above</a>.</p><p><strong>Make sure you have followed the gerrit credentials setup instructions <a href="http://www.chromium.org/chromium-os/developer-guide/gerrit-guide">here</a>.</strong></p><p>(<strong>Note:</strong> If you are on a slow network connection or have low disk space, you can use the <strong>minilayout</strong> option below. This starts you out with a minimum amount of source code. This isn&#39;t a particularly well tested configuration and has been known to break from time-to-time, so we usually recommend against it.)</p><pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln">
cd $</span><span class="pun">{</span><span class="pln">HOME</span><span class="pun">}/</span><span class="pln">chromiumos
</span><span class="com"># Note: Add the &quot;-g minilayout&quot; option to do a minilayout checkout.</span><span class="pln">
repo init </span><span class="pun">-</span><span class="pln">u https</span><span class="pun">:</span><span class="com">//chromium.googlesource.com/chromiumos/manifest.git --repo-url https://chromium.googlesource.com/external/repo.git [-g minilayout]</span><span class="pln">
</span><span class="com"># Note: -j4 tells repo to concurrently sync up to 4 repositories at once.</span><span class="pln">
</span><span class="com"># You can adjust the number based on how fast your internet connection</span><span class="pln">
</span><span class="com"># is. For the initial sync, it&#39;s generally requested that you use no</span><span class="pln">
</span><span class="com"># more than 8 concurrent jobs. (For later syncs, when you already have</span><span class="pln">
</span><span class="com"># the majority of the source local, using -j16 or so is generally okay).</span><span class="pln">
repo sync </span><span class="pun">-</span><span class="pln">j4
</span></pre><p><strong>Googlers:</strong> See <a href="http://goto/chromeos-building">goto/chromeos-building</a> for internal notes.</p><h4><a class="h" name="Optionally-add-Google-API-keys" href="#Optionally-add-Google-API-keys"><span></span></a><a class="h" name="optionally-add-google-api-keys" href="#optionally-add-google-api-keys"><span></span></a>Optionally add Google API keys</h4><p>Secondly, decide whether you need to use features of Chromium that access Google APIs from the image you are building (<strong>signing in</strong>, translating web pages, geolocation, etc). If the answer is yes, you will need to have keys (see <a href="http://www.chromium.org/developers/how-tos/api-keys">API Keys</a>) either in your include.gypi, or in a file in your home directory called &ldquo;.googleapikeys&rdquo;. If either of these file are present for step 1 of building (below) they will be included automatically. If you don&#39;t have these keys, these features of chromium will be quietly disabled.</p><h4><a class="h" name="Branch-Builds" href="#Branch-Builds"><span></span></a><a class="h" name="branch-builds" href="#branch-builds"><span></span></a>Branch Builds</h4><p>If you want to build on a branch, pass the branch name to repo init (e.g: <code class="code">repo init -u &lt;URL&gt; [-g minilayout] **-b 0.9.94.T**</code>).</p><p>When you use <code class="code">repo init</code> you will be asked to confirm your name, email address, and whether you want color in your terminal. This command runs quickly. The <code class="code">repo sync</code> command takes a lot longer.</p><p>More info can be found in the <a href="https://sites.google.com/a/chromium.org/dev/chromium-os/how-tos-and-troubleshooting/working-on-a-branch">working on a branch page</a>.</p><h2><a class="h" name="Building-Chromium-OS" href="#Building-Chromium-OS"><span></span></a><a class="h" name="building-chromium-os" href="#building-chromium-os"><span></span></a>Building Chromium OS</h2><h3><a class="h" name="Create-a-chroot" href="#Create-a-chroot"><span></span></a><a class="h" name="create-a-chroot" href="#create-a-chroot"><span></span></a>Create a chroot</h3><p>To make sure everyone uses the same exact environment and tools to build Chromium OS, all building is done inside a <a href="http://en.wikipedia.org/wiki/Chroot">chroot</a>. This chroot is its own little world: it contains its own compiler, its own tools (its own copy of bash, its own copy of sudo), etc. Now that you&lsquo;ve synced down the source code, you need to create this chroot. Assuming you&rsquo;re already in <code class="code">${HOME}/chromiumos</code> (or wherever your source lives), the command to download and install the chroot is:</p><pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln"> cros_sdk
</span></pre><p>If this does not work, make sure you&#39;ve added the depot_tools directory to your PATH already (as was needed above with using <code class="code">repo</code>).</p><p>This will download and setup a prebuilt chroot from Chromium OS mirrors (under 400M). If you prefer to rather build it from source, or have trouble accessing the servers, use <code class="code">cros_sdk --bootstrap</code>. Note that this will also enter the chroot. If you prefer to build only, use <code class="code">--download</code>.</p><p>The command with <code class="code">--bootstrap</code> takes about half an hour to run on a four core machine. It compiles quite a bit of software, which it installs into your chroot, and downloads some additional items (around 300MB). While it is building you will see a regular update of the number of packages left to build. Once the command finishes, the chroot will take up total disk space of a little over 3GB.</p><p>The chroot lives by default at <code class="code">${HOME}/chromiumos/chroot</code>. Inside that directory you will find system directories like <code class="code">/usr/bin</code> and <code class="code">/etc</code>. These are local to the chroot and are separate from the system directories on your machine. For example, the chroot has its own version of the <code class="code">ls</code> utility. It will be very similar, but it is actually a different binary than the normal one you use on your machine.</p><p><strong>SIDE NOTES:</strong></p><ul><li>You shouldn&#39;t have to create the chroot very often. Most developers create it once and never touch it again unless someone explicitly sends out an email telling them to recreate their chroot.</li><li>The <code class="code">cros_sdk</code> command currently doesn&#39;t work behind a proxy server, but there is a <a href="http://crosbug.com/10048">workaround</a>.</li><li>To help personalizing your chroot, the file <code class="code">${HOME}/.cros_chroot_init</code> is executed (if it exists) <em>when the chroot is created</em>. The path to the chroot is passed as its argument (<code class="code">$1</code>). (If you want to modify the chroot environment you can modify the <code class="code">${HOME}/scripts/bash_completion</code> file).</li></ul><h3><a class="h" name="Enter-the-chroot" href="#Enter-the-chroot"><span></span></a><a class="h" name="enter-the-chroot" href="#enter-the-chroot"><span></span></a>Enter the chroot</h3><p>Most of the commands that Chromium OS developers use on a day-to-day basis (including the commands to build a Chromium OS image) expect to be run from within the chroot. You can enter the chroot by calling:</p><pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln"> cros_sdk
</span></pre><p>This is the same command used to create the chroot, but if the chroot already exists, it will just enter.</p><p>NOTE: if you want to run a single command in the chroot (rather than entering the chroot), prefix that command with <code class="code">cros_sdk --</code>.</p><p>This command will probably prompt you for your password for the <code class="code">sudo</code> command (entering the chroot requires root privileges). Once the command finishes, that terminal is in the chroot and you&#39;ll be in the <code class="code">~/trunk/src/scripts</code> directory, where most build commands live. In the chroot you can only see a subset of the filesystem on your machine. However, through some trickery (bind mounts), you will have access to the whole <code class="code">src</code> directory from within the chroot – this is so that you can build the software within the chroot.</p><p>Note in particular that the <code class="code">src/scripts</code> directory is the same <code class="code">src/scripts</code> directory found within the Chromium OS directory you were in before you entered the chroot, even though it looks like a different location. That&#39;s because when you enter the chroot, the <code class="code">~/trunk</code> directory in the chroot is mounted such that it points to the main Chromium OS directory <code class="code">${HOME}/chromiumos</code>. That means that changes that you make to the source code outside of the chroot immediately take effect inside the chroot.</p><p>Calling this will also install a chroot, if you don&#39;t have one yet, for example by not following the above.</p><p>While in the chroot you will see a special &ldquo;(cr)&rdquo; prompt to remind you that you are there:</p><pre class="code"><span class="pun">(</span><span class="pln">cr</span><span class="pun">)</span><span class="pln"> </span><span class="pun">((...))</span><span class="pln"> johnnyrotten@flyingkite </span><span class="pun">~</span><span class="str">/trunk/</span><span class="pln">src</span><span class="pun">/</span><span class="pln">scripts $
</span></pre><p>You generally cannot run programs on your filesystem from within the chroot. For example, if you are using eclipse as an IDE, or gedit to edit a text file, you will need to run those programs outside the chroot. As a consolation, you can use vim. If you are desperate for emacs, try typing <code class="code">sudo emerge emacs</code>. Of course this command will build emacs from source so allow 5-10mins.</p><p><strong>IMPORTANT NOTES</strong>:</p><ul><li><strong>If you need to delete your chroot</strong>, use <code class="code">cros_sdk --delete</code> to delete it properly. Using <code class="code">rm -rf</code> could end up deleting your source tree due to the active bind mounts.</li></ul><p><strong>SIDE NOTES:</strong></p><ul><li>If you need to share lots of files inside and outside chroot (for example, settings for your favorite editor / tools, or files downloaded by browser outside chroot, etc.), read <a href="https://sites.google.com/a/chromium.org/dev/chromium-os/tips-and-tricks-for-chromium-os-developers">Tips and Tricks</a>.</li><li>There is a file system loop because inside <code class="code">~/trunk</code> you will find the chroot again. Don&lsquo;t think about this for too long. If you try to use <code class="code">du -s ${HOME}/chromiumos/chroot/home</code> you might get a message about a corrupted file system. This is nothing to worry about, and just means that your computer doesn&rsquo;t understand this loop either. (If you <em>can</em> understand this loop, try <a href="http://www.google.com/search?q=the+fourth+dimension">something harder</a>.)</li></ul><h3><a class="h" name="Select-a-board" href="#Select-a-board"><span></span></a><a class="h" name="select-a-board" href="#select-a-board"><span></span></a>Select a board</h3><p>Building Chromium OS produces a disk image (usually just called an &ldquo;image&rdquo;) that can be copied directly onto the boot disk of a computer intended to run Chromium OS. Depending on the specifics of that computer, you may want different files in the disk image. For example, if your computer has an ARM processor, you&lsquo;ll want to make sure that all executables in the image are compiled for the ARM instruction set. Similarly, if your computer has special hardware, you&rsquo;ll want to include a matching set of device drivers.</p><p>Different classes of computers are referred to by Chromium OS as different target &ldquo;boards&rdquo; The following are some example boards:</p><ul><li><strong>amd64-generic -</strong> builds a generic image suitable for computers with a x86_64-compatible CPU (64 bit)<ul><li>Use this board if you&#39;re unsure what you want ... most likely this is the one you want!</li></ul></li><li><strong>x86-generic</strong> - builds a generic image suitable for computers with a x86-compatible CPU (32 bit)</li><li><strong>arm-generic</strong> - builds a generic image suitable for computers with an ARM CPU (32 bit)</li></ul><p>You need to choose a board for your first build. Don&#39;t worry too much about this choice – you can always build for another board later. If you want a list of known boards, you can look in <code class="code">~/trunk/src/overlays</code>.</p><p>Each command in the build processes takes a <code class="code">--board</code> parameter. To facilitate this, it can be helpful to keep the name of the board in a shell variable. This is not strictly necessary, but if you do this, you can simply copy and paste the commands below into your terminal program. Enter the following inside your chroot (note: change <code class="code">amd64-generic</code> to whatever board you want to build for):</p><pre class="code"><span class="pun">(</span><span class="pln">inside</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">export</span><span class="pln"> BOARD</span><span class="pun">=</span><span class="pln">amd64</span><span class="pun">-</span><span class="kwd">generic</span><span class="pln">
</span></pre><p>This setting only holds while you stay in the chroot. If you leave and come back, you need to do specify this setting again.</p><p><strong>SIDE NOTES:</strong></p><ul><li>If you look at <code class="code">~/trunk/src/overlays</code>, you may notice two different naming patterns: <code class="code">overlay-BOARD</code> and <code class="code">overlay-variant-BOARD-VARIANT</code> (note the dash here). If you intend to build for particular board variant, you&#39;ll want to use <code class="code">BOARD_VARIANT</code> pair (note the underscore here) as your board name. E.g. for overlay-variant-peach-pi the correct value for <code class="code">BOARD</code> would be <code class="code">peach_pi</code>.</li></ul><h3><a class="h" name="Initialize-the-build-for-a-board" href="#Initialize-the-build-for-a-board"><span></span></a><a class="h" name="initialize-the-build-for-a-board" href="#initialize-the-build-for-a-board"><span></span></a>Initialize the build for a board</h3><p>To start building for a given board, issue the following command inside your chroot (you should be in the <code class="code">~/trunk/src/scripts</code> directory):</p><pre class="code"><span class="pun">(</span><span class="pln">inside</span><span class="pun">)</span><span class="pln"> </span><span class="pun">./</span><span class="pln">setup_board </span><span class="pun">--</span><span class="pln">board</span><span class="pun">=</span><span class="pln">$</span><span class="pun">{</span><span class="pln">BOARD</span><span class="pun">}</span><span class="pln">
</span></pre><p>This command sets up the board target with a default sysroot of <code class="code">/build/${BOARD}</code>. The command downloads a small amount of stuff and takes a few minutes to complete.</p><p><strong>SIDE NOTES:</strong></p><ul><li>If you pass the <code class="code">--default</code> flag to <code class="code">setup_board</code>, the command writes the board name in the file <code class="code">~/trunk/src/scripts/.default_board</code> (it does the same thing as <code class="code">echo ${BOARD} &gt; ~/trunk/src/scripts/.default_board</code>). This makes it so that you don&#39;t need to specify a <code class="code">--board</code> argument to subsequent commands. These instructions do not use the <code class="code">--default</code> flag so that you can explicitly see what commands are board-specific.</li><li>If you have previously set up this board, the <code class="code">setup_board</code> command will fail. If you really want to clobber your old board files and start fresh, try passing the <code class="code">--force</code> flag, which deletes the old <code class="code">/build/${BOARD}</code> directory for you. Like <code class="code">cros_sdk</code>, most people only re-run <code class="code">setup_board</code> when told to (they don&#39;t re-run it even after a <code class="code">repo sync</code>).</li><li>You can delete the board sysroot at any time with: <code class="code">sudo rm -rf /build/${BOARD}</code></li></ul><h3><a class="h" name="Set-the-chronos-user-password" href="#Set-the-chronos-user-password"><span></span></a><a class="h" name="set-the-chronos-user-password" href="#set-the-chronos-user-password"><span></span></a>Set the chronos user password</h3><p>On a Chromium OS computer, you can get command line access (and root access through the <code class="code">sudo</code> command) by logging in with the shared user account <code class="code">&quot;chronos&quot;</code>. You should set a password for the <code class="code">chronos</code> user by entering the command below from inside the <code class="code">~/trunk/src/scripts</code> directory:</p><pre class="code"><span class="pun">(</span><span class="pln">inside</span><span class="pun">)</span><span class="pln"> </span><span class="pun">./</span><span class="pln">set_shared_user_password</span><span class="pun">.</span><span class="pln">sh
</span></pre><p>You will be prompted for a password, which will be stored in encrypted form in <code class="code">/etc/shared_user_passwd.txt</code>.</p><p><strong>SIDE NOTES:</strong></p><ul><li>The encrypted password is stored inside chroot. That means that if you recreate your chroot, you have to run this command again.</li><li>If you don&#39;t set a shared user password, the password for the chronos account may end up being any number of things depending on some complicated (and constantly evolving) formula that includes whether you build a developer image, whether you boot into developer mode, and the current state of the scripts. The password might be empty, or a well-known string (such as <code class="code">&quot;test0000&quot;</code> on test images), or it might be impossible to login with chronos. It is strongly recommended that you simply set a shared user password. TODO: put a link to some place with more info about this.</li></ul><h3><a class="h" name="Build-the-packages-for-your-board" href="#Build-the-packages-for-your-board"><span></span></a><a class="h" name="build-the-packages-for-your-board" href="#build-the-packages-for-your-board"><span></span></a>Build the packages for your board</h3><p>To build all the packages for your board, run the following command from inside the <code class="code">~/trunk/src/scripts</code> directory:</p><pre class="code"><span class="pun">(</span><span class="pln">inside</span><span class="pun">)</span><span class="pln"> </span><span class="pun">./</span><span class="pln">build_packages </span><span class="pun">--</span><span class="pln">board</span><span class="pun">=</span><span class="pln">$</span><span class="pun">{</span><span class="pln">BOARD</span><span class="pun">}</span><span class="pln">
</span></pre><p>This step is the rough equivalent of <code class="code">make all</code> in a standard Makefile system. This command handles incremental builds; you should run it whenever you change something and need to rebuild it (or after you run <code class="code">repo sync</code>).</p><p>Normally, the build_packages command builds the stable version of a package (i.e. from committed git sources), unless you are working on a package (with <code class="code">cros_workon</code>). If you are working on a package, build_packages will build using your local sources. See below for information about <code class="code">cros_workon</code>.</p><p><strong>SIDE NOTES:</strong></p><ul><li><p>Even though there are some flags that can optimize your build (like <code class="code">--nowithdev</code>, --nowithautotest, etc), you <strong>should not</strong> use these flags (even if you don&#39;t plan on building a developer / test image). There are some <a href="http://crosbug.com/5777">issues with virtual packages</a> that can cause some hard-to-debug differences if you use one of these flags.</p></li><li><p>The <code class="code">--nowithdebug</code> flag is an exception to the previous point. By default, packages other than Chrome will be compiled in debug mode; that is, with <code class="code">NDEBUG</code> undefined and with debugging constructs like <code class="code">DCHECK</code>, <code class="code">DLOG</code>, and the red &ldquo;Debug image&rdquo; message present. If you supply <code class="code">--nowithdebug</code>, then <code class="code">NDEBUG</code> will be defined and the debugging constructs will be removed.</p></li><li><p>The first time you run the <code class="code">build_packages</code> command, it will take a long time (around 90 minutes on a four core machine), as it must build every package, and also download about 1.7GB of source packages and 1.3GB of binary packages. <a href="https://sites.google.com/a/chromium.org/dev/chromium-os/how-tos-and-troubleshooting/portage-build-faq#TOC-What-does-build_packages-actually-do-">See here</a> for more information about what the build_packages command actually does. In short, it tries to download existing binary packages to avoid building anything (and puts them in <code class="code">/build/${BOARD}/packages</code> for subsequent builds). Failing that, it downloads source packages, puts them in <code class="code">/var/lib/portage/distfiles-target</code>, and builds them.</p></li></ul><h3><a class="h" name="Build-a-disk-image-for-your-board" href="#Build-a-disk-image-for-your-board"><span></span></a><a class="h" name="build-a-disk-image-for-your-board" href="#build-a-disk-image-for-your-board"><span></span></a>Build a disk image for your board</h3><p>Once the <code class="code">build_packages</code> step is finished, you can build a Chromium OS-base developer image by running the command below from inside the <code class="code">~/trunk/src/scripts</code> directory:</p><pre class="code"><span class="pun">(</span><span class="pln">inside</span><span class="pun">)</span><span class="pln"> </span><span class="pun">./</span><span class="pln">build_image </span><span class="pun">--</span><span class="pln">board</span><span class="pun">=</span><span class="pln">$</span><span class="pun">{</span><span class="pln">BOARD</span><span class="pun">}</span><span class="pln"> </span><span class="pun">--</span><span class="pln">noenable_rootfs_verification test
</span></pre><p>The args for build_image specify what type of build you want (test in the example above). It is more convenient to use test images, but developers could also build developer (dev) images. A developer image provides a Chromium OS-based image with additional developer packages. To build a test image with additional test-specific packages that also accepts an incoming ssh connection, use &lsquo;test&rsquo; instead of &lsquo;dev&rsquo;. If building a test image, the password set using <code class="code">set_shared_user_password.sh</code> will be ignored and <code class="code">&quot;test0000&quot;</code> will be the password instead. The <code class="code">--noenable_rootfs_verification</code> turns off verified boot allowing you to freely modify the root file system. The system is less secure using this flag, however, for rapid development you may want to set this flag. If you would like a more secure, locked-down version of Chromium OS, then simply remove the <code class="code">--noenable_rootfs_verification</code> flag. Finally if you want just the pristine Chromium OS-based image (closest to Chrome OS but not quite the same), pass in <code class="code">base</code> rather than dev. Use <code class="code">build_image --help</code> for more information.</p><p>The image produced by build_image will be located in <code class="code">~/trunk/src/build/images/${BOARD}/versionNum/</code> (where <code class="code">versionNum</code> will actually be a version number). The most recent image produced for a given board will be symlinked to <code class="code">~/trunk/src/build/images/${BOARD}/latest</code>.</p><p><strong>IMPORTANT NOTE:</strong> It&lsquo;s up to you to delete old builds that you don&rsquo;t need. Every time you run <code class="code">build_image</code>, the command creates files that take up <strong>over 4GB of space(!)</strong>.</p><h3><a class="h" name="Look-at-your-disk-image-optional" href="#Look-at-your-disk-image-optional"><span></span></a><a class="h" name="look-at-your-disk-image-optional" href="#look-at-your-disk-image-optional"><span></span></a>Look at your disk image (optional)</h3><p>The preferred way to mount the image you just built to look at its contents is:</p><pre class="code"><span class="pun">(</span><span class="pln">inside</span><span class="pun">)</span><span class="pln">
</span><span class="pun">./</span><span class="pln">mount_gpt_image</span><span class="pun">.</span><span class="pln">sh </span><span class="pun">--</span><span class="pln">board</span><span class="pun">=</span><span class="pln">$</span><span class="pun">{</span><span class="pln">BOARD</span><span class="pun">}</span><span class="pln"> </span><span class="pun">--</span><span class="pln">safe </span><span class="pun">--</span><span class="pln">most_recent
</span></pre><p>If you built a test image, also make sure to add <code class="code">-i chromiumos_test_image.bin</code> to this command.</p><p>The <code class="code">--safe</code> option ensures you do not make accidental changes to the Root FS.</p><p>Again, don&lsquo;t forget to unmount the root filesystem when you&rsquo;re done:</p><pre class="code"><span class="pun">(</span><span class="pln">inside</span><span class="pun">)</span><span class="pln"> </span><span class="pun">./</span><span class="pln">mount_gpt_image</span><span class="pun">.</span><span class="pln">sh </span><span class="pun">--</span><span class="pln">board</span><span class="pun">=</span><span class="pln">$</span><span class="pun">{</span><span class="pln">BOARD</span><span class="pun">}</span><span class="pln"> </span><span class="pun">-</span><span class="pln">u
</span></pre><p>Optionally, you can unpack the partition as separate files and mount them directly:</p><pre class="code"><span class="pun">(</span><span class="pln">inside</span><span class="pun">)</span><span class="pln">
cd </span><span class="pun">~</span><span class="str">/trunk/</span><span class="pln">src</span><span class="pun">/</span><span class="pln">build</span><span class="pun">/</span><span class="pln">images</span><span class="pun">/</span><span class="pln">$</span><span class="pun">{</span><span class="pln">BOARD</span><span class="pun">}/</span><span class="pln">latest
</span><span class="pun">./</span><span class="pln">unpack_partitions</span><span class="pun">.</span><span class="pln">sh chromiumos_image</span><span class="pun">.</span><span class="pln">bin
mkdir </span><span class="pun">-</span><span class="pln">p rootfs
sudo mount </span><span class="pun">-</span><span class="pln">o loop</span><span class="pun">,</span><span class="pln">ro part_3 rootfs
</span></pre><p>This will do a loopback mount of the rootfs from your image to the location <code class="code">~/trunk/src/build/images/${BOARD}/latest/rootfs</code> in your chroot.</p><p>If you built with <code class="code">&quot;--noenable_rootfs_verification&quot;</code> you can omit the &ldquo;ro&rdquo; option to mount it read write.</p><p>If you built an x86 Chromium OS image, you can probably even try chrooting into the image:</p><pre class="code"><span class="pun">(</span><span class="pln">inside</span><span class="pun">)</span><span class="pln"> sudo chroot </span><span class="pun">~</span><span class="str">/trunk/</span><span class="pln">src</span><span class="pun">/</span><span class="pln">build</span><span class="pun">/</span><span class="pln">images</span><span class="pun">/</span><span class="pln">$</span><span class="pun">{</span><span class="pln">BOARD</span><span class="pun">}/</span><span class="pln">latest</span><span class="pun">/</span><span class="pln">rootfs
</span></pre><p>This is a little hacky (the Chromium OS rootfs isn&lsquo;t really designed to be a chroot for your host machine), but it seems to work pretty well. Don&rsquo;t forget to <code class="code">exit</code> this chroot when you&#39;re done.</p><p>When you&#39;re done, unmount the root filesystem:</p><pre class="code"><span class="pun">(</span><span class="pln">inside</span><span class="pun">)</span><span class="pln"> sudo umount </span><span class="pun">~</span><span class="str">/trunk/</span><span class="pln">src</span><span class="pun">/</span><span class="pln">build</span><span class="pun">/</span><span class="pln">images</span><span class="pun">/</span><span class="pln">$</span><span class="pun">{</span><span class="pln">BOARD</span><span class="pun">}/</span><span class="pln">latest</span><span class="pun">/</span><span class="pln">rootfs
</span></pre><h2><a class="h" name="Installing-Chromium-OS-on-your-Device" href="#Installing-Chromium-OS-on-your-Device"><span></span></a><a class="h" name="installing-chromium-os-on-your-device" href="#installing-chromium-os-on-your-device"><span></span></a>Installing Chromium OS on your Device</h2><h3><a class="h" name="Put-your-image-on-a-USB-disk" href="#Put-your-image-on-a-USB-disk"><span></span></a><a class="h" name="put-your-image-on-a-usb-disk" href="#put-your-image-on-a-usb-disk"><span></span></a>Put your image on a USB disk</h3><p>The easiest way to get your image running on your target computer is to put the image on a USB flash disk (sometimes called a USB key), and boot the target computer from the flash disk.</p><p>The first step is to disable auto-mounting of USB devices on your build computer as it may corrupt the disk image while it&lsquo;s being written. Next, insert a USB flash disk (4GB or bigger) into your build computer. **This disk will be completely erased, so make sure it doesn&rsquo;t have anything important on it**. Wait ~10 seconds for the USB disk to register, then type the following command:</p><pre class="code"><span class="pun">(</span><span class="pln">inside</span><span class="pun">)</span><span class="pln"> cros flash usb</span><span class="pun">:</span><span class="com">// ${BOARD}/latest</span><span class="pln">
</span></pre><p>For more details on using this tool, see the <a href="https://sites.google.com/a/chromium.org/dev/chromium-os/build/cros-flash">Cros Flash page</a>.</p><p>When the <code class="code">cros flash</code> command finishes, you can simply unplug your USB key and it&#39;s ready to boot from.</p><p><strong>IMPORTANT NOTE:</strong> To emphasize again, <code class="code">cros flash</code> completely replaces the contents of your USB disk. Make sure there is nothing important on your USB disk before you run this command.</p><p><strong>SIDE NOTES:</strong></p><ul><li>If you want to create a test image (used for integration testing), see the <a href="#Running-Tests">Running Tests</a> section.</li></ul><h3><a class="h" name="Disable-verified-boot" href="#Disable-verified-boot"><span></span></a><a class="h" name="disable-verified-boot" href="#disable-verified-boot"><span></span></a>Disable verified boot</h3><p>You need to disable verified boot to be able to use your own image. Sometimes it can be achieved by holding the reset shortcuts (Esc-F3-Power) for a long time. Try with your machine for a while until you figure it out. Disabling verified boot takes some time, and is often accompanied by entering developer mode.</p><p>How this is accomplished for non Google Chrome OS devices depends heavily on the BIOS and can vary drastically, so we will not attempt to cover that.</p><p>For Google Chrome OS devices, see the <a href="https://sites.google.com/a/chromium.org/dev/chromium-os/getting-dev-hardware/dev-hardware-list">Developer Hardware</a> page. (Pages of each devices will show how to enter dev mode which will disable verified boot.)</p><h3><a class="h" name="Boot-from-your-USB-disk" href="#Boot-from-your-USB-disk"><span></span></a><a class="h" name="boot-from-your-usb-disk" href="#boot-from-your-usb-disk"><span></span></a>Boot from your USB disk</h3><p>For Google Chrome OS devices, you must first put the device into developer mode. There are two potential ways to do this, depending on your device. If you have a physical developer switch, move it to ON position. Otherwise if your device is using “keyboard based developer / recovery switch”, do that by first Esc-F3-Power to recovery mode, then Ctrl-D and ENTER to activate the virtual developer switch (Note if you’re already in developer mode, Ctrl-D won’t do anything - just move to next step).</p><p>Entering developer mode takes a while, the device removes all personal data and resets itself.</p><p>Then you should set your system to boot from USB. Let it boot, login and open a shell (or switch to terminal 2 via Ctrl+Alt+F2). Run the following command:</p><pre class="code"><span class="pun">(</span><span class="pln">device</span><span class="pun">)</span><span class="pln"> sudo crossystem
</span></pre><p>You should see <code class="code">&quot;dev_boot_usb&quot;</code> equal to 0. Set it to 1 to enable USB boot:</p><pre class="code"><span class="pun">(</span><span class="pln">device</span><span class="pun">)</span><span class="pln"> sudo crossystem dev_boot_usb</span><span class="pun">=</span><span class="lit">1</span><span class="pln">
</span></pre><p>Now reboot. In the white screen (developer mode enabled) screen, plug-in the USB and press Ctrl+U (or whatever key boots from USB on your device).</p><p>For specific information about what works on various different machines, see the <a href="https://sites.google.com/a/chromium.org/dev/chromium-os/developer-information-for-chrome-os-devices">Developer Hardware</a> page.</p><h3><a class="h" name="Installing-your-Chromium-OS-image-to-your-hard-disk" href="#Installing-your-Chromium-OS-image-to-your-hard-disk"><span></span></a><a class="h" name="installing-your-chromium-os-image-to-your-hard-disk" href="#installing-your-chromium-os-image-to-your-hard-disk"><span></span></a>Installing your Chromium OS image to your hard disk</h3><p>Once you&#39;ve booted from your USB key and gotten to the command prompt, you can install your Chromium OS image to the hard disk on your computer with this command:</p><pre class="code"><span class="pun">(</span><span class="pln">device</span><span class="pun">)</span><span class="pln"> </span><span class="pun">/</span><span class="pln">usr</span><span class="pun">/</span><span class="pln">sbin</span><span class="pun">/</span><span class="pln">chromeos</span><span class="pun">-</span><span class="pln">install
</span></pre><p><strong>IMPORTANT NOTE:</strong> Installing Chromium OS onto your hard disk will <strong>WIPE YOUR HARD DISK CLEAN</strong>.</p><h3><a class="h" name="Getting-to-a-command-prompt-on-Chromium-OS" href="#Getting-to-a-command-prompt-on-Chromium-OS"><span></span></a><a class="h" name="getting-to-a-command-prompt-on-chromium-os" href="#getting-to-a-command-prompt-on-chromium-os"><span></span></a>Getting to a command prompt on Chromium OS</h3><p>Since you set the shared user password (with <code class="code">set_shared_user_password.sh</code>) when you built your image, you have the ability to login as the chronos user:</p><ol><li>After your computer has booted to the Chromium OS login screen, press <code class="code">[ Ctrl ] [ Alt ] [ F2 ]</code> to get a text-based login prompt. ( <code class="code">[ F2 ]</code> may appear as <code class="code">[ → ]</code> on your Notebook keyboard.)</li><li>Login with the  chronos  user and enter the password you set earlier.</li></ol><p>Because you built an image with developer tools, you also have an alternate way to get a terminal prompt. The alternate shell is a little nicer (in the very least, it keeps your screen from dimming on you), even if it is a little harder to get to. To use this alternate shell:</p><ol><li>Go through the standard Chromium OS login screen (you&lsquo;ll need to setup a network, etc.) and get to the web browser. It&rsquo;s OK to login as guest.</li><li>Press <code class="code">[ Ctrl ] [ Alt ] [ T ]</code> to get the <a href="https://chromium.googlesource.com/chromiumos/platform2/+/master/crosh/">crosh</a> shell.</li><li>Use the <code class="code">shell</code> command to get the shell prompt. NOTE: you <strong>don&#39;t</strong> need to enter the <code class="code">chronos</code> password here, though you will still need the password if you want to use the <code class="code">sudo</code> command.</li></ol><h3><a class="h" name="Building-an-image-to-run-in-a-virtual-machine" href="#Building-an-image-to-run-in-a-virtual-machine"><span></span></a><a class="h" name="building-an-image-to-run-in-a-virtual-machine" href="#building-an-image-to-run-in-a-virtual-machine"><span></span></a>Building an image to run in a virtual machine</h3><p>Many times it is easier to simply run Chromium OS in a virtual machine like kvm. You can adapt the previously built Chromium OS image so that it is usable by <code class="code">kvm</code> (which uses qemu images) by entering this command from the <code class="code">~/trunk/src/scripts</code> directory:</p><pre class="code"><span class="pun">(</span><span class="pln">inside</span><span class="pun">)</span><span class="pln"> </span><span class="pun">./</span><span class="pln">image_to_vm</span><span class="pun">.</span><span class="pln">sh </span><span class="pun">--</span><span class="pln">board</span><span class="pun">=</span><span class="pln">$</span><span class="pun">{</span><span class="pln">BOARD</span><span class="pun">}</span><span class="pln">
</span></pre><p>This command creates the file <code class="code">~/trunk/src/build/images/${BOARD}/latest/chromiumos_qemu_image.bin</code>.</p><p><strong>SIDE NOTES:</strong></p><ul><li>WARNING: After <a href="https://bugs.chromium.org/p/chromium/issues/detail?id=710629">crbug/710629</a>, &lsquo;betty&rsquo; is the only board regularly run through pre-CQ and CQ VMTest and so is the most likely to work at ToT. &lsquo;betty&rsquo; is based on &lsquo;amd64-generic&rsquo;, though, so &lsquo;amd64-generic&rsquo; is likely to also work.</li><li>Only KVM/QEMU VM&#39;s are actively supported at the moment.</li><li>You can specify source/destination paths with the <code class="code">--from</code> and <code class="code">--to</code> parameters.</li><li>If you&#39;re interested in creating a test image (used for integration testing), see the <a href="#Running-Tests">Running Tests</a> section.</li></ul><h2><a class="h" name="Making-changes-to-packages-whose-source-code-is-checked-into-Chromium-OS-git-repositories" href="#Making-changes-to-packages-whose-source-code-is-checked-into-Chromium-OS-git-repositories"><span></span></a><a class="h" name="making-changes-to-packages-whose-source-code-is-checked-into-chromium-os-git-repositories" href="#making-changes-to-packages-whose-source-code-is-checked-into-chromium-os-git-repositories"><span></span></a>Making changes to packages whose source code is checked into Chromium OS git repositories</h2><p>Now that you can build and run Chromium OS, you&#39;re ready to start making changes to the code.</p><p><strong>NOTE:</strong> If you skipped to this section without building your own system image, you may run into hard-to-fix dependency problems if build your own versions of system packages and try to deploy them to a system image that was built by a builder. If you run into trouble, try going through the full <a href="#Building-Chromium-OS">Building Chromium OS</a> process first and installing your own system image.</p><h3><a class="h" name="Keep-the-tree-green" href="#Keep-the-tree-green"><span></span></a><a class="h" name="keep-the-tree-green" href="#keep-the-tree-green"><span></span></a>Keep the tree green</h3><p>Before you start, take a moment to understand Chromium&#39;s source management strategy of &ldquo;keeping the tree green&rdquo;. For the Chromium OS project, <strong>keeping the tree green</strong> means:</p><ol><li>Any new commits should not destabilize the build:<ul><li>Images built from the tree should always have basic functionality working.</li><li>There may be minor functionality not working, and it may be the case, for example, that you will need to use Terminal to fix or work around some of the problems.</li></ul></li><li>If you must introduce unstable changes to the tree (which should happen infrequently), you should use parameterization to hide new, unstable functionality behind a flag that&#39;s turned off by default. The Chromium OS team leaders may need to develop mechanisms for parameterizing different parts of the system (such as the init script).</li><li>Internal &ldquo;dev channel&rdquo; releases will be produced directly from the tree, with a quick branch to check-point the release version. Any fixes required for a release will be pulled from the tree, avoiding merges back to tree.</li></ol><p>This strategy has many benefits, including avoiding separate build trains for parallel development (and the cost of supporting such development), as well as avoiding large, costly merges from forked branches.</p><p><strong>SIDE NOTE</strong>: &ldquo;Keep the tree green&rdquo; means something a bit different for Chromium OS than for Chromium, which is much further along in its life cycle.</p><p>The steps in this section describe how to make changes to a Chromium OS package whose source is checked into the Chromium OS source control system. Specifically, this is a package where:</p><ul><li>The <code class="code">**ebuild**</code> for the package lives in the <code class="code">src/third_party/chromiumos-overlay</code> or <code class="code">src/overlays/overlay-${BOARD}</code> directories.</li><li>There is an ebuild for the package that ends with  <code class="code">9999.ebuild</code>.</li><li>The ebuild inherits from the <code class="code">cros-workon</code>  class.</li><li>The ebuild has a <code class="code">KEYWORDS</code> in the ebuild containing this architecture name (like &ldquo;<code class="code">x86</code>&rdquo;).</li></ul><p>You can see a list of all such packages by running the following command from inside the <code class="code">~/trunk/src/scripts</code> directory:</p><pre class="code"><span class="pun">(</span><span class="pln">inside</span><span class="pun">)</span><span class="pln"> cros_workon </span><span class="pun">--</span><span class="pln">board</span><span class="pun">=</span><span class="pln">$</span><span class="pun">{</span><span class="pln">BOARD</span><span class="pun">}</span><span class="pln"> </span><span class="pun">--</span><span class="pln">all list
</span></pre><h3><a class="h" name="Run-cros_workon-start" href="#Run-cros_workon-start"><span></span></a><a class="h" name="run-cros_workon-start" href="#run-cros_workon-start"><span></span></a>Run cros_workon start</h3><p>The first thing you need to do is to mark the package as active. Use the command below, replacing <code class="code">${PACKAGE_NAME}</code> with your package name (e.g., <code class="code">chromeos-wm</code>):</p><pre class="code"><span class="pun">(</span><span class="pln">inside</span><span class="pun">)</span><span class="pln"> cros_workon </span><span class="pun">--</span><span class="pln">board</span><span class="pun">=</span><span class="pln">$</span><span class="pun">{</span><span class="pln">BOARD</span><span class="pun">}</span><span class="pln"> start $</span><span class="pun">{</span><span class="pln">PACKAGE_NAME</span><span class="pun">}</span><span class="pln">
</span></pre><p>This command:</p><ul><li>Indicates that you&#39;d like to build the <code class="code">9999</code> version of the <code class="code">ebuild</code> instead of the stable, committed version.</li><li>Indicates that you&#39;d like to build from source every time.</li><li>If you specified that you wanted the <code class="code">minilayout</code> when you did your <code class="code">repo init</code>, this command adds a clause to your <code class="code">.repo/local_manifest.xml</code> to tell <code class="code">repo</code> to sync down the source code for this package next time you do a <code class="code">repo sync</code>.</li></ul><h3><a class="h" name="Run-repo-sync" href="#Run-repo-sync"><span></span></a><a class="h" name="run-repo-sync" href="#run-repo-sync"><span></span></a>Run repo sync</h3><p>After running <code class="code">cros_workon</code>, sync down the sources. This is critical if you&lsquo;re using the <code class="code">minilayout</code>, but is probably a good idea in any case to make sure that you&rsquo;re working with the latest code (it&#39;ll help avoid merge conflicts later). Run the command below from outside the chroot, anywhere under your <code class="code">~/chromiumos</code> directory:</p><pre class="code"><span class="pln">repo sync
</span></pre><h3><a class="h" name="Find-out-which-ebuilds-map-to-which-directories" href="#Find-out-which-ebuilds-map-to-which-directories"><span></span></a><a class="h" name="find-out-which-ebuilds-map-to-which-directories" href="#find-out-which-ebuilds-map-to-which-directories"><span></span></a>Find out which ebuilds map to which directories</h3><p>The <code class="code">cros_workon</code> tool can help you find out what ebuilds map to each directory. You can view a full list of ebuilds and directories using the following command:</p><pre class="code"><span class="pun">(</span><span class="pln">inside</span><span class="pun">)</span><span class="pln"> cros_workon </span><span class="pun">--</span><span class="pln">board</span><span class="pun">=</span><span class="pln">$</span><span class="pun">{</span><span class="pln">BOARD</span><span class="pun">}</span><span class="pln"> </span><span class="pun">--</span><span class="pln">all info
</span></pre><p>If you want to find out which ebuilds use source code from a specific directory, you can use grep to find them. For example:</p><pre class="code"><span class="pun">(</span><span class="pln">inside</span><span class="pun">)</span><span class="pln"> cros_workon </span><span class="pun">--</span><span class="pln">board</span><span class="pun">=</span><span class="pln">$</span><span class="pun">{</span><span class="pln">BOARD</span><span class="pun">}</span><span class="pln"> </span><span class="pun">--</span><span class="pln">all info </span><span class="pun">|</span><span class="pln"> grep platform</span><span class="pun">/</span><span class="pln">ec
</span></pre><p>This returns the following output:</p><pre class="code"><span class="pln">chromeos</span><span class="pun">-</span><span class="kwd">base</span><span class="pun">/</span><span class="pln">ec</span><span class="pun">-</span><span class="pln">utils chromiumos</span><span class="pun">/</span><span class="pln">platform</span><span class="pun">/</span><span class="pln">ec src</span><span class="pun">/</span><span class="pln">platform</span><span class="pun">/</span><span class="pln">ec
</span></pre><p>This tells you the following information:</p><ol><li>The name of the ebuild is <code class="code">chromeos-base/ec-utils</code></li><li>The path to the git repository on the server is <code class="code">chromiumos/platform/ec</code></li><li>The path to the source code on your system is <code class="code">src/platform/ec</code></li></ol><p>You can similarly find what source code is associated with a given ebuild by grepping for the ebuild name in the list.</p><p>To find out where the ebuild lives:</p><pre class="code"><span class="pun">(</span><span class="pln">inside</span><span class="pun">)</span><span class="pln"> equery</span><span class="pun">-</span><span class="pln">$</span><span class="pun">{</span><span class="pln">BOARD</span><span class="pun">}</span><span class="pln"> which $</span><span class="pun">{</span><span class="pln">PACKAGE_NAME</span><span class="pun">}</span><span class="pln">
</span></pre><p>As an example, for <code class="code">PACKAGE_NAME=ec-utils</code>, the above command might display:</p><pre class="code"><span class="str">/home/</span><span class="pun">.../</span><span class="pln">trunk</span><span class="pun">/</span><span class="pln">src</span><span class="pun">/</span><span class="pln">third_party</span><span class="pun">/</span><span class="pln">chromiumos</span><span class="pun">-</span><span class="pln">overlay</span><span class="pun">/</span><span class="pln">chromeos</span><span class="pun">-</span><span class="kwd">base</span><span class="pun">/</span><span class="pln">ec</span><span class="pun">-</span><span class="pln">utils</span><span class="pun">/</span><span class="pln">ec</span><span class="pun">-</span><span class="pln">utils</span><span class="pun">-</span><span class="lit">9999.ebuild</span><span class="pln">
</span></pre><p><strong>SIDE NOTE:</strong> If you run the same command <strong>without</strong> running <code class="code">cros_workon</code> first, you can see the difference:</p><pre class="code"><span class="str">/home/</span><span class="pun">.../</span><span class="pln">trunk</span><span class="pun">/</span><span class="pln">src</span><span class="pun">/</span><span class="pln">third_party</span><span class="pun">/</span><span class="pln">chromiumos</span><span class="pun">-</span><span class="pln">overlay</span><span class="pun">/</span><span class="pln">chromeos</span><span class="pun">-</span><span class="kwd">base</span><span class="pun">/</span><span class="pln">ec</span><span class="pun">-</span><span class="pln">utils</span><span class="pun">/</span><span class="pln">ec</span><span class="pun">-</span><span class="pln">utils</span><span class="pun">-</span><span class="lit">0.0</span><span class="pun">.</span><span class="lit">1</span><span class="pun">-</span><span class="pln">r134</span><span class="pun">.</span><span class="pln">ebuild
</span></pre><h3><a class="h" name="Create-a-branch-for-your-changes" href="#Create-a-branch-for-your-changes"><span></span></a><a class="h" name="create-a-branch-for-your-changes" href="#create-a-branch-for-your-changes"><span></span></a>Create a branch for your changes</h3><p>Since Chromium OS uses <code class="code">repo</code>/<code class="code">git</code>, you should always create a local branch whenever you make changes.</p><p>First, find the source directory for the project you just used <code class="code">cros_workon</code> on. This isn&lsquo;t directly related to the project name you used with <code class="code">cros_workon</code>. (This isn&rsquo;t very helpful - someone with more experience, actually tell us how to find it reliably? --Meredydd)</p><p>cd into that directory, in particular the <code class="code">&quot;files/&quot;</code> directory in which the actual source resides. In the command below, replace <code class="code">${BRANCH_NAME}</code> with a name that is meaningful to you and that describes your changes (nobody else will see this name):</p><pre class="code"><span class="pln">repo start $</span><span class="pun">{</span><span class="pln">BRANCH_NAME</span><span class="pun">}</span><span class="pln"> </span><span class="pun">.</span><span class="pln">
</span></pre><p>The branch that this creates will be based on the remote branch (which one? --Meredydd). If you&#39;ve made any other local changes, they will not be present in this branch.</p><h3><a class="h" name="Make-your-changes" href="#Make-your-changes"><span></span></a><a class="h" name="make-your-changes" href="#make-your-changes"><span></span></a>Make your changes</h3><p>You should be able to make your changes to the source code now. To incrementally compile your changes, use either <code class="code">cros_workon_make</code> or <code class="code">emerge-${BOARD}</code>. To use <code class="code">cros_workon_make</code>, run</p><pre class="code"><span class="pun">(</span><span class="pln">inside</span><span class="pun">)</span><span class="pln"> cros_workon_make </span><span class="pun">--</span><span class="pln">board</span><span class="pun">=</span><span class="pln">$</span><span class="pun">{</span><span class="pln">BOARD</span><span class="pun">}</span><span class="pln"> $</span><span class="pun">{</span><span class="pln">PACKAGE_NAME</span><span class="pun">}</span><span class="pln">
</span></pre><p>This will build your package inside your source directory. Change a single file, and it will rebuild only that file and re-link. If your package contains test binaries, using</p><pre class="code"><span class="pun">(</span><span class="pln">inside</span><span class="pun">)</span><span class="pln"> cros_workon_make </span><span class="pun">--</span><span class="pln">board</span><span class="pun">=</span><span class="pln">$</span><span class="pun">{</span><span class="pln">BOARD</span><span class="pun">}</span><span class="pln"> $</span><span class="pun">{</span><span class="pln">PACKAGE_NAME</span><span class="pun">}</span><span class="pln"> </span><span class="pun">--</span><span class="pln">test
</span></pre><p>will build and run those binaries as well. Call <code class="code">cros_workon_make --help</code> to see other options that are supported.</p><p>You probably want to get your changes onto your device now. You need to install the changes you made by using</p><pre class="code"><span class="pun">(</span><span class="pln">inside</span><span class="pun">)</span><span class="pln"> cros_workon_make </span><span class="pun">--</span><span class="pln">board</span><span class="pun">=</span><span class="pln">$</span><span class="pun">{</span><span class="pln">BOARD</span><span class="pun">}</span><span class="pln"> $</span><span class="pun">{</span><span class="pln">PACKAGE_NAME</span><span class="pun">}</span><span class="pln"> </span><span class="pun">--</span><span class="pln">install
</span></pre><p>You can then rebuild an image with <code class="code">build_image</code> and reimage your device.</p><p>Alternatively, you can build your package using <code class="code">emerge-${BOARD}</code> and quickly install it to the device by using <a href="https://sites.google.com/a/chromium.org/dev/chromium-os/build/cros-deploy">cros deploy</a>.</p><p>For example, if you want to build <code class="code">ec-utils</code> to test on your device, use</p><pre class="code"><span class="pun">(</span><span class="pln">inside</span><span class="pun">)</span><span class="pln"> emerge</span><span class="pun">-</span><span class="pln">$</span><span class="pun">{</span><span class="pln">BOARD</span><span class="pun">}</span><span class="pln"> ec</span><span class="pun">-</span><span class="pln">utils
</span></pre><p>To install the package to the device, use</p><pre class="code"><span class="pun">(</span><span class="pln">inside</span><span class="pun">)</span><span class="pln"> cros deploy $</span><span class="pun">{</span><span class="pln">IP</span><span class="pun">}</span><span class="pln"> ec</span><span class="pun">-</span><span class="pln">utils
</span></pre><h3><a class="h" name="Set-your-editor" href="#Set-your-editor"><span></span></a><a class="h" name="set-your-editor" href="#set-your-editor"><span></span></a>Set your editor</h3><p>Many of the commands below (in particular <code class="code">git</code>) open up an editor. You probably want to run one of the three commands below depending on your favorite editor.</p><p>If you&#39;re not a *nix expert, <code class="code">nano</code> is a reasonable editor:</p><pre class="code"><span class="kwd">export</span><span class="pln"> EDITOR</span><span class="pun">=</span><span class="str">&#39;nano&#39;</span><span class="pln">
</span></pre><p>If you love  <code class="code">vi</code>:</p><pre class="code"><span class="kwd">export</span><span class="pln"> EDITOR</span><span class="pun">=</span><span class="str">&#39;vi&#39;</span><span class="pln">
</span></pre><p>If you love <code class="code">emacs</code> (and don&#39;t want an X window to open up every time you do something):</p><pre class="code"><span class="kwd">export</span><span class="pln"> EDITOR</span><span class="pun">=</span><span class="str">&#39;emacs -nw&#39;</span><span class="pln">
</span></pre><p>You should probably add one of those lines to your <code class="code">.bashrc</code> (or similar file) too.</p><h3><a class="h" name="Submit-changes-locally" href="#Submit-changes-locally"><span></span></a><a class="h" name="submit-changes-locally" href="#submit-changes-locally"><span></span></a>Submit changes locally</h3><p>When your changes look good, commit them to your local branch using <code class="code">git</code>. Full documentation of how to use git is beyond the scope of this guide, but you might be able to commit your changes by running something like the command below from the project directory:</p><pre class="code"><span class="pln">git commit </span><span class="pun">-</span><span class="pln">a
</span></pre><p>The git commit command brings up a text editor. You should describe your changes, save, and exit the editor. Note that the description you provide is only for your own use. When you upload your changes for code review, the repo upload command grabs all of your previous descriptions, and gives you a chance to edit them.</p><h3><a class="h" name="Upload-your-changes-and-get-a-code-review" href="#Upload-your-changes-and-get-a-code-review"><span></span></a><a class="h" name="upload-your-changes-and-get-a-code-review" href="#upload-your-changes-and-get-a-code-review"><span></span></a>Upload your changes and get a code review</h3><p>Check out our <a href="contributing.md">Gerrit Workflow</a> guide for details on our review process.</p><h3><a class="h" name="Clean-up-after-you_re-done-with-your-changes" href="#Clean-up-after-you_re-done-with-your-changes"><span></span></a><a class="h" name="clean-up-after-you_re-done-with-your-changes" href="#clean-up-after-you_re-done-with-your-changes"><span></span></a>Clean up after you&#39;re done with your changes</h3><p>After you&lsquo;re done with your changes, you&rsquo;re ready to clean up. The most important thing to do is to tell <code class="code">cros_workon</code> that you&#39;re done by running the following command:</p><pre class="code"><span class="pun">(</span><span class="pln">inside</span><span class="pun">)</span><span class="pln"> cros_workon </span><span class="pun">--</span><span class="pln">board</span><span class="pun">=</span><span class="pln">$</span><span class="pun">{</span><span class="pln">BOARD</span><span class="pun">}</span><span class="pln"> stop $</span><span class="pun">{</span><span class="pln">PACKAGE_NAME</span><span class="pun">}</span><span class="pln">
</span></pre><p>This command tells <code class="code">cros_workon</code> to stop forcing the <code class="code">-9999.ebuild</code> and to stop forcing a build from source every time.</p><p>If you&#39;re using the <code class="code">minilayout</code>, doing a <code class="code">cros_workon</code> stop <strong>will not</strong> remove your source code. The code will continue to stay on your hard disk and get synced down.</p><h2><a class="h" name="Making-changes-to-non_cros_workon_able-packages" href="#Making-changes-to-non_cros_workon_able-packages"><span></span></a><a class="h" name="making-changes-to-non_cros_workon_able-packages" href="#making-changes-to-non_cros_workon_able-packages"><span></span></a>Making changes to non-cros_workon-able packages</h2><p>If you want to make to changes to something other than packages whose source is checked into the Chromium OS source control system, you can follow the instructions in the previous section, but skip the <code class="code">cros_workon</code> step. Note specifically that you still need to run <code class="code">repo start</code> to <a href="#Create-a-branch-for-your-changes">Create a branch for your changes</a>.</p><p>The types of changes that fall into this category include:</p><ul><li>changes to build scripts (pretty much anything in <code class="code">src/scripts</code>)</li><li>changes to <code class="code">ebuild</code> files themselves (like the ones in <code class="code">src/third_party/chromiumos-overlay</code>)<ul><li>To change these files, you need to &ldquo;manually uprev&rdquo; the package. For example, if we&#39;re making a modification to for the Pixel overlay (link), then</li><li><code class="code">cd src/overlays/overlay-link/chromeos-base/chromeos-bsp-link</code></li><li><code class="code">mv chromeos-bsp-link-0.0.2-r29.ebuild chromeos-bsp-link-0.0.2-r30.ebuild</code></li><li><code class="code">chromeos-bsp-link-0.0.2-r29.ebuild</code> is a symlink that points to <code class="code">chromeos-bsp-link-0.0.2.ebuild</code>. To uprev the package, simply increment the revision (r29) number.</li></ul></li><li>adding small patches to existing packages whose source code is NOT checked into Chromium OS git repositories</li><li>changes to <code class="code">eclass</code> files (like the ones in <code class="code">src/third_party/chromiumos-overlay/eclass</code>)</li><li>changes to the buildbot infrastructure (in <code class="code">crostools</code>)</li><li>changes to Chromium OS project documentation (in <code class="code">docs</code>)</li><li>TODO: anything else?</li></ul><h3><a class="h" name="Adding-small-patches-to-existing-packages" href="#Adding-small-patches-to-existing-packages"><span></span></a><a class="h" name="adding-small-patches-to-existing-packages" href="#adding-small-patches-to-existing-packages"><span></span></a>Adding small patches to existing packages</h3><p>When you need to add small patches to existing packages whose source code is not checked into a Chromium OS git repository (e.g. it comes from portage, and is not a <code class="code">cros_workon</code>-able package), you need to do the following:</p><p>First, find the package ebuild file under <code class="code">third_party/chromiumos-overlay</code>.</p><p>Then, create a patch file from the exact version of the package that is used by the current ebuild. If other patches are already in the ebuild, you&#39;ll want to add your patch LAST, and build the patch off of the source that has already had the existing patches applied (either do it by hand, or set <code class="code">FEATURES=noclean</code> and build your patch off of the temp source). Note that patch order is significant, since the ebuild expects each patch line number to be accurate after the previous patch is applied.</p><p>Place your patch in the &ldquo;files&rdquo; subdir of the directory that contains the ebuild file (e.g. <code class="code">third_party/chromiumos-overlay/dev-libs/mypackage/files/mypackage-1.0.0-my-little-patch.patch</code>).</p><p>Then, in the <code class="code">prepare()</code> section of the ebuild (create one if it doesn&#39;t exist), add an epatch line:</p><pre class="code"><span class="pln">epatch </span><span class="str">&quot;${FILESDIR}&quot;</span><span class="pun">/</span><span class="pln">$</span><span class="pun">{</span><span class="pln">P</span><span class="pun">}-</span><span class="kwd">my</span><span class="pun">-</span><span class="pln">little</span><span class="pun">-</span><span class="pln">patch</span><span class="pun">.</span><span class="pln">patch
</span></pre><p>Lastly, you&#39;ll need to bump the revision number in the name of the ebuild file (or symlink) so the build system picks up the change. The current wisdom is that the ebuild file should be symlinked instead of being renamed. For example, if the original ebuild file is <code class="code">&quot;mypackage-1.0.0.ebuild&quot;</code>, you should create a <code class="code">&quot;mypackage-1.0.0-r1.ebuild&quot;</code> symbolic link that points at the original ebuild file. If that symlink already exists, create the next higher &ldquo;rN&rdquo; symlink.</p><h3><a class="h" name="Making-changes-to-the-way-that-the-chroot-is-constructed" href="#Making-changes-to-the-way-that-the-chroot-is-constructed"><span></span></a><a class="h" name="making-changes-to-the-way-that-the-chroot-is-constructed" href="#making-changes-to-the-way-that-the-chroot-is-constructed"><span></span></a>Making changes to the way that the chroot is constructed</h3><p>TODO: This section is currently a placeholder, waiting for someone to fill it in. However, a few notes:</p><ul><li>Many of the commands that take a <code class="code">--board=${BOARD}</code> parameter also take a <code class="code">--host</code> parameter, which makes the commands affect the host (i.e. the chroot) rather than the board.<ul><li>Most notably, <code class="code">cros_workon --host</code> says that you want to build a package used in the chroot from source.</li></ul></li></ul><h3><a class="h" name="Building-an-individual-package" href="#Building-an-individual-package"><span></span></a><a class="h" name="building-an-individual-package" href="#building-an-individual-package"><span></span></a>Building an individual package</h3><p>TODO: Document this better, and add the new <code class="code">cros_workon_make</code>.</p><p><strong>SIDE NOTE:</strong> To build an individual portage package, for a particular board, use <code class="code">emerge-${BOARD}</code>.</p><p>For example, if you want to build dash to test on your device:</p><pre class="code"><span class="pun">(</span><span class="pln">inside</span><span class="pun">)</span><span class="pln"> emerge</span><span class="pun">-</span><span class="pln">$</span><span class="pun">{</span><span class="pln">BOARD</span><span class="pun">}</span><span class="pln"> dash
</span></pre><p>To install the package to the device, see <a href="https://sites.google.com/a/chromium.org/dev/chromium-os/build/cros-deploy">cros deploy</a>.</p><h3><a class="h" name="Making-changes-to-the-Chromium-web-browser-on-Chromium-OS" href="#Making-changes-to-the-Chromium-web-browser-on-Chromium-OS"><span></span></a><a class="h" name="making-changes-to-the-chromium-web-browser-on-chromium-os" href="#making-changes-to-the-chromium-web-browser-on-chromium-os"><span></span></a>Making changes to the Chromium web browser on Chromium OS</h3><p>If you just want to make modifications to the Chromium web browser and quickly deploy your changes to an already-built Chromium OS image, see <a href="https://sites.google.com/a/chromium.org/dev/chromium-os/how-tos-and-troubleshooting/building-chromium-browser">Making changes to the Chromium web browser on Chromium OS</a>.</p><p>To use your local checkout of the Chromium source code when building a Chromium OS image, set the <code class="code">--chrome_root</code> flag appropriately when entering the chroot, e.g.</p><pre class="code"><span class="pun">(</span><span class="pln">outside</span><span class="pun">)</span><span class="pln"> cros_sdk </span><span class="pun">--</span><span class="pln">chrome_root</span><span class="pun">=</span><span class="pln">$</span><span class="pun">{</span><span class="pln">HOME</span><span class="pun">}/</span><span class="pln">chrome
</span></pre><p>Within the chroot, you&#39;ll also need to either start working on the <code class="code">chromeos-chrome</code> package:</p><pre class="code"><span class="pun">(</span><span class="pln">inside</span><span class="pun">)</span><span class="pln"> cros_workon </span><span class="pun">--</span><span class="pln">board</span><span class="pun">=</span><span class="pln">$</span><span class="pun">{</span><span class="pln">BOARD</span><span class="pun">}</span><span class="pln"> start chromeos</span><span class="pun">-</span><span class="pln">chrome
</span></pre><p>or set the <code class="code">CHROME_ORIGIN</code> environment variable appropriately:</p><pre class="code"><span class="pun">(</span><span class="pln">inside</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">export</span><span class="pln"> CHROME_ORIGIN</span><span class="pun">=</span><span class="pln">LOCAL_SOURCE
</span></pre><p>See <code class="code">src/third_party/chromiumos-overlay/chromeos-base/chromeos-chrome/chromeos-chrome-9999.ebuild</code> for additional possible values for the <code class="code">CHROME_ORIGIN</code> variable.</p><p>If you have an internal checkout of the Google Chrome source and want to build the browser with official branding, export <code class="code">USE=chrome_internal</code>.</p><h2><a class="h" name="Using-Clang-to-get-better-compiler-diagnostics" href="#Using-Clang-to-get-better-compiler-diagnostics"><span></span></a><a class="h" name="using-clang-to-get-better-compiler-diagnostics" href="#using-clang-to-get-better-compiler-diagnostics"><span></span></a>Using Clang to get better compiler diagnostics</h2><h3><a class="h" name="Description" href="#Description"><span></span></a><a class="h" name="description" href="#description"><span></span></a>Description</h3><p>The ChromeOS toolchain provides a feature to get Clang syntax-only compiler diagnostics without having to do a separate build with the Clang compiler. To enable this feature, add <code class="code">-clang</code> to the <code class="code">C[XX]FLAGS</code> used by the package for its build.</p><p>Addition of the <code class="code">-clang</code> option to the build is interpreted by the compiler driver wrapper script, which then invokes Clang with -fsyntax-only option, and after a successful Clang run, invokes the gcc compiler. Any errors generated by Clang will stop compilation just like a regular build does. In addition to Clang warnings, you will also see warning from gcc, in some cases for the same source construct.</p><p>The presence of a few specific gcc options, for example, <code class="code">-print-*</code> or <code class="code">-E</code> will disable a clang run, even if <code class="code">-clang</code> is specified. This is to allow package configure scripts to run correctly even in the presence of the <code class="code">-clang</code> option.</p><h3><a class="h" name="Wrapper-Options" href="#Wrapper-Options"><span></span></a><a class="h" name="wrapper-options" href="#wrapper-options"><span></span></a>Wrapper Options</h3><p>The wrapper script also interprets a few other options. All options specific to the wrapper only are tabulated below:</p><ul><li><code class="code">-clang</code>: Invoke Clang front-end with <code class="code">-fsyntax-only</code> and all other options specified on the command line. On successful completion of Clang compile, continue the build with gcc or <code class="code">g++</code>.  The presence of <code class="code">-print-*</code>, <code class="code">-dump*</code>, <code class="code">@*</code>, <code class="code">-E</code>, <code class="code">-</code> or <code class="code">-M</code> will disable clang invocation.</li><li><code class="code">-Xclang-only=&lt;option&gt;</code>: This is a special option that can be used to pass <code class="code">&lt;option&gt;</code> to Clang and not to <code class="code">gcc</code> or <code class="code">g++</code>. This can be used, for example, to turn off a specific Clang warning. Example: <code class="code">-Xclang-only=-Wno-c++11-extension</code>s will add <code class="code">-Wno-c++11-extensions</code> to the Clang invocation.</li><li><code class="code">-print-cmdline</code>: In addition to doing the builds, print the exact command-line used for both Clang and gcc.</li></ul><h3><a class="h" name="Testing" href="#Testing"><span></span></a><a class="h" name="testing" href="#testing"><span></span></a>Testing</h3><p>You can test your package with Clang before adding <code class="code">-clang</code> to your ebuild or Makefiles using the <code class="code">CFLAGS</code> or <code class="code">CXXFLAGS</code> variable. While using this, you need to be careful not to overwrite existing <code class="code">CFLAGS</code> or <code class="code">CXXFLAGS</code>. Here&#39;s an example:</p><pre class="code"><span class="pun">(</span><span class="pln">inside</span><span class="pun">)</span><span class="pln">
$ CFLAGS</span><span class="pun">=</span><span class="str">&quot;$(portageq-$board envvar CFLAGS) -clang&quot;</span><span class="pln"> \
  CXXFLAGS</span><span class="pun">=</span><span class="str">&quot;$(portageq-$board envvar CXXFLAG) -clang&quot;</span><span class="pln"> \
  emerge</span><span class="pun">-</span><span class="pln">$board chromeos</span><span class="pun">-</span><span class="pln">chrome
</span></pre><p>After your package builds cleanly with Clang, you can add <code class="code">-clang</code> to your ebuild.</p><h2><a class="h" name="Local-Debugging" href="#Local-Debugging"><span></span></a><a class="h" name="local-debugging" href="#local-debugging"><span></span></a>Local Debugging</h2><h3><a class="h" name="Debugging-both-x86-and-non_x86-binaries-on-your-workstation" href="#Debugging-both-x86-and-non_x86-binaries-on-your-workstation"><span></span></a><a class="h" name="debugging-both-x86-and-non_x86-binaries-on-your-workstation" href="#debugging-both-x86-and-non_x86-binaries-on-your-workstation"><span></span></a>Debugging both x86 and non-x86 binaries on your workstation.</h3><p>If you build your projects incrementally, write unit tests and use them to drive your development, you may want to debug your code without shipping it over to a running device or VM.</p><p><code class="code">gdb-${BOARD}</code> sets up gdb in your board sysroot and ensures that gdb is using the proper libraries, debug files, etc. for debugging, allowing you to run your target-compiled binaries.</p><p>It should already be installed in your chroot. If you do not have the script, update your repository to get the latest changes, then re-build your packages:</p><pre class="code"><span class="pln">repo sync

</span><span class="pun">(</span><span class="pln">inside</span><span class="pun">)</span><span class="pln"> </span><span class="pun">./</span><span class="pln">build_packages </span><span class="pun">--</span><span class="pln">board</span><span class="pun">=...</span><span class="pln">
</span></pre><p>This should install <code class="code">gdb-${BOARD}</code> in the <code class="code">/usr/local/bin</code> directory inside the chroot. These board-specific gdb wrapper scripts correctly handle <em>both local and remote debugging</em> (see next section for more information on remote debugging). When used for local debugging, these scripts will run inside a special chroot-inside-your-chroot, rooted in the board&#39;s sysroot. For example if you are using <code class="code">gdb-lumpy</code>, it will run inside a chroot based entirely in your <code class="code">/build/lumpy</code> sysroot. <em>The libraries that it will load and use are the libraries in the sysroot,</em> i.e. the target libraries for the board; the gdb binary it will use is the gdb binary in that tree. While debugging with <code class="code">gdb-lumpy</code> (for local debugging), you will not be able to see/access any files outside of the <code class="code">/build/lumpy</code> tree. While for the most part this is very good, as it ensures the correct debugging environment, it does mean that if you want to use this script to debug a lumpy binary, such as a unit test, that you built outside of the <code class="code">/build/lumpy</code> tree, you will need to copy the binary to the <code class="code">/build/lumpy</code> tree first. Also, if you want the debugger to be able to see the source files when debugging, you will need to make sure they exist inside the <code class="code">/build/lumpy</code> tree as well (see example below).</p><p><strong>IMPORTANT NOTE 1</strong>: Local and remote debugging functionality are combined in this single script. Some of the options shown below only work for remote debugging.</p><p><strong>IMPORTANT NOTE 2</strong>: When doing local debugging of x86 binaries, they will try to execute on your desktop machine (using the appropriate libraries and gdb binaries). It is possible that for some x86 boards, the binaries may use instructions not understood by your hardware (particularly some vector instructions), in which case you will need to do remote debugging with the actual hardware instead.</p><p><strong>IMPORTANT NOTE 3</strong>: You can use this script with *some* debugging functionality for local debugging of non-x86 binaries. The script loads qemu and runs the non-x86 binaries in qemu. However qemu has some unfortunate limitations. For example you can &ldquo;set&rdquo; breakpoints in the binary (to see what addresses correspond to locations in the source), examine the source or assembly code, and execute the program. But qemu does not actually hit the breakpoints, so you cannot suspend execution in the middle when running under qemu. For full debugging functionality with non-x86 binaries, you must debug them remotely running on the correct hardware (see next section on remote debugging). You can see this in the example below, where gdb-daisy does not actually stop at the breakpoint it appears to set, although it does correctly execute the program.</p><pre class="code"><span class="pun">(</span><span class="pln">inside</span><span class="pun">)</span><span class="pln">
</span><span class="pun">(</span><span class="pln">cr</span><span class="pun">)</span><span class="pln"> $ gdb</span><span class="pun">-</span><span class="pln">daisy </span><span class="pun">-</span><span class="pln">h

usage</span><span class="pun">:</span><span class="pln"> cros_gdb </span><span class="pun">[-</span><span class="pln">h</span><span class="pun">]</span><span class="pln">
                </span><span class="pun">[--</span><span class="pln">log</span><span class="pun">-</span><span class="pln">level </span><span class="pun">{</span><span class="pln">fatal</span><span class="pun">,</span><span class="pln">critical</span><span class="pun">,</span><span class="pln">error</span><span class="pun">,</span><span class="pln">warning</span><span class="pun">,</span><span class="pln">notice</span><span class="pun">,</span><span class="pln">info</span><span class="pun">,</span><span class="pln">debug</span><span class="pun">}]</span><span class="pln">
                </span><span class="pun">[--</span><span class="pln">log_format LOG_FORMAT</span><span class="pun">]</span><span class="pln"> </span><span class="pun">[--</span><span class="pln">debug</span><span class="pun">]</span><span class="pln"> </span><span class="pun">[--</span><span class="pln">nocolor</span><span class="pun">]</span><span class="pln">
                </span><span class="pun">[--</span><span class="pln">board BOARD</span><span class="pun">]</span><span class="pln"> </span><span class="pun">[-</span><span class="pln">g GDB_ARGS</span><span class="pun">]</span><span class="pln"> </span><span class="pun">[--</span><span class="pln">remote REMOTE</span><span class="pun">]</span><span class="pln"> </span><span class="pun">[--</span><span class="pln">pid PID</span><span class="pun">]</span><span class="pln">
                </span><span class="pun">[--</span><span class="pln">remote_pid PID</span><span class="pun">]</span><span class="pln"> </span><span class="pun">[--</span><span class="kwd">no</span><span class="pun">-</span><span class="pln">ping</span><span class="pun">]</span><span class="pln"> </span><span class="pun">[--</span><span class="pln">attach ATTACH_NAME</span><span class="pun">]</span><span class="pln"> </span><span class="pun">[--</span><span class="pln">cgdb</span><span class="pun">]</span><span class="pln">
                </span><span class="pun">[</span><span class="pln">binary</span><span class="pun">-</span><span class="pln">to</span><span class="pun">-</span><span class="pln">be</span><span class="pun">-</span><span class="pln">debugged</span><span class="pun">]</span><span class="pln"> </span><span class="pun">[</span><span class="pln">args</span><span class="pun">-</span><span class="kwd">for</span><span class="pun">-</span><span class="pln">binary</span><span class="pun">-</span><span class="pln">being</span><span class="pun">-</span><span class="pln">debugged</span><span class="pun">]</span><span class="pln">

</span><span class="typ">Wrapper</span><span class="pln"> </span><span class="kwd">for</span><span class="pln"> running gdb</span><span class="pun">.</span><span class="pln">

</span><span class="typ">This</span><span class="pln"> handles the fun details like running against the right sysroot</span><span class="pun">,</span><span class="pln"> via
qemu</span><span class="pun">,</span><span class="pln"> bind mounts</span><span class="pun">,</span><span class="pln"> etc</span><span class="pun">...</span><span class="pln">

positional arguments</span><span class="pun">:</span><span class="pln">
  inf_args              </span><span class="typ">Arguments</span><span class="pln"> </span><span class="kwd">for</span><span class="pln"> gdb to </span><span class="kwd">pass</span><span class="pln"> to the program being
                        debugged</span><span class="pun">.</span><span class="pln"> </span><span class="typ">These</span><span class="pln"> are positional </span><span class="kwd">and</span><span class="pln"> must come at the
                        </span><span class="kwd">end</span><span class="pln"> of the command line</span><span class="pun">.</span><span class="pln"> </span><span class="typ">This</span><span class="pln"> will </span><span class="kwd">not</span><span class="pln"> work </span><span class="kwd">if</span><span class="pln">
                        attaching to an already running program</span><span class="pun">.</span><span class="pln">
</span><span class="pun">...</span><span class="pln">

</span><span class="pun">(</span><span class="pln">cr</span><span class="pun">)</span><span class="pln"> $ gdb</span><span class="pun">-</span><span class="pln">daisy </span><span class="pun">/</span><span class="pln">bin</span><span class="pun">/</span><span class="pln">grep shebang </span><span class="pun">/</span><span class="pln">bin</span><span class="pun">/</span><span class="pln">ls
</span><span class="lit">15</span><span class="pun">:</span><span class="lit">51</span><span class="pun">:</span><span class="lit">06</span><span class="pun">:</span><span class="pln"> INFO</span><span class="pun">:</span><span class="pln"> </span><span class="typ">RunCommand</span><span class="pun">:</span><span class="pln"> file </span><span class="pun">/</span><span class="pln">build</span><span class="pun">/</span><span class="pln">daisy</span><span class="pun">/</span><span class="pln">bin</span><span class="pun">/</span><span class="pln">grep
</span><span class="typ">Reading</span><span class="pln"> symbols </span><span class="kwd">from</span><span class="pln"> </span><span class="pun">/</span><span class="pln">bin</span><span class="pun">/</span><span class="pln">grep</span><span class="pun">...</span><span class="typ">Reading</span><span class="pln"> symbols </span><span class="kwd">from</span><span class="pln"> </span><span class="pun">/</span><span class="pln">usr</span><span class="pun">/</span><span class="pln">lib</span><span class="pun">/</span><span class="pln">debug</span><span class="pun">/</span><span class="pln">bin</span><span class="pun">/</span><span class="pln">grep</span><span class="pun">.</span><span class="pln">debug</span><span class="pun">...</span><span class="kwd">done</span><span class="pun">.</span><span class="pln">
</span><span class="kwd">done</span><span class="pun">.</span><span class="pln">
</span><span class="pun">(</span><span class="pln">daisy</span><span class="pun">-</span><span class="pln">gdb</span><span class="pun">)</span><span class="pln"> b main
</span><span class="typ">Breakpoint</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> at </span><span class="lit">0x2814</span><span class="pun">:</span><span class="pln"> file grep</span><span class="pun">.</span><span class="pln">c</span><span class="pun">,</span><span class="pln"> line </span><span class="lit">2111.</span><span class="pln">
</span><span class="pun">(</span><span class="pln">daisy</span><span class="pun">-</span><span class="pln">gdb</span><span class="pun">)</span><span class="pln"> disass main
</span><span class="typ">Dump</span><span class="pln"> of assembler code </span><span class="kwd">for</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> main</span><span class="pun">:</span><span class="pln">
   </span><span class="lit">0x00002814</span><span class="pln"> </span><span class="pun">&lt;+</span><span class="lit">0</span><span class="pun">&gt;:</span><span class="pln"> ldr</span><span class="pun">.</span><span class="pln">w r2</span><span class="pun">,</span><span class="pln"> </span><span class="pun">[</span><span class="pln">pc</span><span class="pun">,</span><span class="pln"> </span><span class="com">#3408] ; 0x3568 &lt;main+3412&gt;</span><span class="pln">
   </span><span class="lit">0x00002818</span><span class="pln"> </span><span class="pun">&lt;+</span><span class="lit">4</span><span class="pun">&gt;:</span><span class="pln"> str</span><span class="pun">.</span><span class="pln">w r4</span><span class="pun">,</span><span class="pln"> </span><span class="pun">[</span><span class="pln">sp</span><span class="pun">,</span><span class="pln"> </span><span class="com">#-36]!</span><span class="pln">
   </span><span class="lit">0x0000281c</span><span class="pln"> </span><span class="pun">&lt;+</span><span class="lit">8</span><span class="pun">&gt;:</span><span class="pln"> movs r4</span><span class="pun">,</span><span class="pln"> </span><span class="com">#0</span><span class="pln">
   </span><span class="lit">0x0000281e</span><span class="pln"> </span><span class="pun">&lt;+</span><span class="lit">10</span><span class="pun">&gt;:</span><span class="pln"> strd r5</span><span class="pun">,</span><span class="pln"> r6</span><span class="pun">,</span><span class="pln"> </span><span class="pun">[</span><span class="pln">sp</span><span class="pun">,</span><span class="pln"> </span><span class="com">#4]</span><span class="pln">
   </span><span class="lit">0x00002822</span><span class="pln"> </span><span class="pun">&lt;+</span><span class="lit">14</span><span class="pun">&gt;:</span><span class="pln"> ldr</span><span class="pun">.</span><span class="pln">w r3</span><span class="pun">,</span><span class="pln"> </span><span class="pun">[</span><span class="pln">pc</span><span class="pun">,</span><span class="pln"> </span><span class="com">#3400] ; 0x356c &lt;main+3416&gt;</span><span class="pln">
   </span><span class="lit">0x00002826</span><span class="pln"> </span><span class="pun">&lt;+</span><span class="lit">18</span><span class="pun">&gt;:</span><span class="pln"> movs r5</span><span class="pun">,</span><span class="pln"> </span><span class="com">#2</span><span class="pln">
   </span><span class="lit">0x00002828</span><span class="pln"> </span><span class="pun">&lt;+</span><span class="lit">20</span><span class="pun">&gt;:</span><span class="pln"> strd r7</span><span class="pun">,</span><span class="pln"> r8</span><span class="pun">,</span><span class="pln"> </span><span class="pun">[</span><span class="pln">sp</span><span class="pun">,</span><span class="pln"> </span><span class="com">#12]</span><span class="pln">
</span><span class="pun">...</span><span class="pln">
</span><span class="pun">(</span><span class="pln">daisy</span><span class="pun">-</span><span class="pln">gdb</span><span class="pun">)</span><span class="pln"> run
</span><span class="typ">Starting</span><span class="pln"> program</span><span class="pun">:</span><span class="pln"> </span><span class="str">/bin/</span><span class="pln">grep shebang </span><span class="pun">/</span><span class="pln">bin</span><span class="pun">/</span><span class="pln">ls
qemu</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Unsupported</span><span class="pln"> syscall</span><span class="pun">:</span><span class="pln"> </span><span class="lit">26</span><span class="pln">
</span><span class="com">#!/usr/bin/coreutils --coreutils-prog-shebang=ls</span><span class="pln">
qemu</span><span class="pun">:</span><span class="pln"> </span><span class="typ">Unsupported</span><span class="pln"> syscall</span><span class="pun">:</span><span class="pln"> </span><span class="lit">26</span><span class="pln">
</span><span class="typ">During</span><span class="pln"> startup program exited normally</span><span class="pun">.</span><span class="pln">
</span><span class="pun">(</span><span class="pln">daisy</span><span class="pun">-</span><span class="pln">gdb</span><span class="pun">)</span><span class="pln"> quit
</span></pre><p>Note in the example above that, like &ldquo;regular&rdquo; gdb when given <code class="code">--args</code>, you can pass the arguments for the program being debugged to the gdb wrapper script just by adding them to the command line after the name of the program being debugged (except that <code class="code">--args</code> isn&#39;t needed).</p><p>The commands below show how to copy your incrementally-compiled unit test binary and source file(s) to the appropriate sysroot and then start gdb with that binary (using the correct libraries, etc).</p><pre class="code"><span class="pun">(</span><span class="pln">inside</span><span class="pun">)</span><span class="pln">
</span><span class="pun">(</span><span class="pln">cr</span><span class="pun">)</span><span class="pln"> $ cd </span><span class="pun">/</span><span class="pln">build</span><span class="pun">/</span><span class="pln">lumpy</span><span class="pun">/</span><span class="pln">tmp</span><span class="pun">/</span><span class="pln">portage
</span><span class="pun">(</span><span class="pln">cr</span><span class="pun">)</span><span class="pln"> $ mkdir shill</span><span class="pun">-</span><span class="pln">test
</span><span class="pun">(</span><span class="pln">cr</span><span class="pun">)</span><span class="pln"> $ cd shill</span><span class="pun">-</span><span class="pln">test
</span><span class="pun">(</span><span class="pln">cr</span><span class="pun">)</span><span class="pln"> $ cp </span><span class="pun">&lt;</span><span class="pln">path</span><span class="pun">-</span><span class="pln">to</span><span class="pun">-</span><span class="pln">binary</span><span class="pun">&gt;/</span><span class="pln">shill_unittest </span><span class="pun">.</span><span class="pln">
</span><span class="pun">(</span><span class="pln">cr</span><span class="pun">)</span><span class="pln"> $ cp </span><span class="pun">&lt;</span><span class="pln">path</span><span class="pun">-</span><span class="pln">to</span><span class="pun">-</span><span class="pln">src</span><span class="pun">&gt;/</span><span class="pln">shill_unittest</span><span class="pun">.</span><span class="pln">cc </span><span class="pun">.</span><span class="pln">
</span><span class="pun">(</span><span class="pln">cr</span><span class="pun">)</span><span class="pln"> $ gdb</span><span class="pun">-</span><span class="pln">lumpy
</span><span class="pun">(</span><span class="pln">gdb</span><span class="pun">-</span><span class="pln">lumpy</span><span class="pun">)</span><span class="pln"> directory </span><span class="pun">/</span><span class="pln">tmp</span><span class="pun">/</span><span class="pln">portage</span><span class="pun">/</span><span class="pln">shill</span><span class="pun">-</span><span class="pln">test </span><span class="com"># Tell gdb to add /tmp/portage/shill-test to the paths it searches for source files</span><span class="pln">
</span><span class="pun">(</span><span class="pln">gdb</span><span class="pun">-</span><span class="pln">lumpy</span><span class="pun">)</span><span class="pln"> file </span><span class="pun">./</span><span class="pln">shill_unittest
</span></pre><p>If gdb is still looking for the source file in the wrong directory path, you can use <code class="code">set substitute-path &lt;from&gt; &lt;to&gt;</code> inside gdb to help it find the right path (inside your sysroot) for searching for source files.</p><h2><a class="h" name="Remote-Debugging" href="#Remote-Debugging"><span></span></a><a class="h" name="remote-debugging" href="#remote-debugging"><span></span></a>Remote Debugging</h2><h3><a class="h" name="Setting-up-remote-debugging-by-hand" href="#Setting-up-remote-debugging-by-hand"><span></span></a><a class="h" name="setting-up-remote-debugging-by-hand" href="#setting-up-remote-debugging-by-hand"><span></span></a>Setting up remote debugging by hand.</h3><p>If you want to manually run through all the steps necessary to set up your system for remote debugging and start the debugger, see <a href="http://www.chromium.org/chromium-os/how-tos-and-troubleshooting/remote-debugging">Remote Debugging in Chromium OS</a>.</p><h3><a class="h" name="Automated-remote-debugging-using-gdb_BOARD_script-gdb_lumpy_gdb_daisy_gdb_parrot_etc" href="#Automated-remote-debugging-using-gdb_BOARD_script-gdb_lumpy_gdb_daisy_gdb_parrot_etc"><span></span></a><a class="h" name="automated-remote-debugging-using-gdb_board_script-gdb_lumpy_gdb_daisy_gdb_parrot_etc" href="#automated-remote-debugging-using-gdb_board_script-gdb_lumpy_gdb_daisy_gdb_parrot_etc"><span></span></a>Automated remote debugging using gdb-${BOARD} script (gdb-lumpy, gdb-daisy, gdb-parrot, etc).</h3><p><code class="code">gdb-${BOARD}</code> is a script that automates many of the steps necessary for setting up remote debugging with gdb. It should already be installed in your chroot. If you do not have the script, update your repository to get the latest changes, then re-build your packages:</p><pre class="code"><span class="pln">repo sync

</span><span class="pun">(</span><span class="pln">inside</span><span class="pun">)</span><span class="pln"> </span><span class="pun">./</span><span class="pln">build_packages </span><span class="pun">--</span><span class="pln">board</span><span class="pun">=...</span><span class="pln">
</span></pre><p>This should install <code class="code">gdb_remote</code> in the <code class="code">/usr/bin</code> directory inside the chroot. The <code class="code">gdb-${BOARD}</code> script takes several options. The most important ones are mentioned below.</p><p><code class="code">--gdb_args</code> (<code class="code">-g</code>) are arguments to be passed to gdb itself (rather than to the program gdb is debugging). If multiple arguments are passed, each argument requires a separate -g flag.</p><p>E.g <code class="code">gdb-lumpy --remote=123.45.67.765 -g &quot;-core=/tmp/core&quot; -g &quot;-directory=/tmp/source&quot;</code></p><p><code class="code">--remote</code> is the ip_address or name for your chromebook, if you are doing remote debugging. If you omit this argument, the assumption is you are doing local debugging in the sysroot on your desktop (see section above). if you are debugging in the VM, then you need to specify either <code class="code">:vm:</code> or <code class="code">localhost:9222</code>.</p><p><code class="code">--pid</code> is the pid of a running process on the remote device to which you want gdb/gdbserver to attach.</p><p><code class="code">--attach</code> is the name of the running process on the remote device to which you want gdb/gdbserver to attach. If you want to attach to the Chrome browser itself, there are three special names you can use: <code class="code">browser</code> will attach to the main browser process; <code class="code">gpu-process</code> will attach to the GPU process; and <code class="code">renderer</code> will attach to the renderer process if there is only one. If there is more than one renderer process <code class="code">--attach=renderer</code> will return a list of the renderer pids and stop.</p><p>To have gdb/gdbserver start and attach to a new (not already running) binary, give the name of the binary, followed by any arguments for the binary, at the end of the command line:</p><pre class="code"><span class="pun">(</span><span class="pln">inside</span><span class="pun">)</span><span class="pln"> $ gdb</span><span class="pun">-</span><span class="pln">daisy </span><span class="pun">--</span><span class="pln">remote</span><span class="pun">=</span><span class="lit">123.45</span><span class="pun">.</span><span class="lit">67.809</span><span class="pln"> </span><span class="pun">/</span><span class="pln">bin</span><span class="pun">/</span><span class="pln">grep </span><span class="str">&quot;test&quot;</span><span class="pln"> </span><span class="pun">/</span><span class="pln">tmp</span><span class="pun">/</span><span class="pln">myfile
</span></pre><p>When doing remote debugging you *must* use the <code class="code">--pid</code> or the <code class="code">--attach</code> option, or specify the name of a new binary to start. You cannot start a remote debugging session without having specified the program to debug in one of these three ways.</p><p>When you invoke <code class="code">gdb-${BOARD} --remote=...</code>, it will connect to the notebook or VM (automatically setting up port-forwarding on the VM), make sure the port is entered into the iptables, and start up gdbserver, using the correct port and binary, either attaching to the binary (if a remote pid or name was specified) or starting up the binary. It will also start the appropriate version of gdb (for whichever type of board you are debugging) on your desktop and connect the gdb on your desktop to the gdbserver on the remote device.</p><h3><a class="h" name="Edit_Debug-cycle" href="#Edit_Debug-cycle"><span></span></a><a class="h" name="edit_debug-cycle" href="#edit_debug-cycle"><span></span></a>Edit/Debug cycle</h3><p>If you want to edit code and debug it on the DUT you can follow this procedure</p><pre class="code"><span class="pln">$ CFLAGS</span><span class="pun">=</span><span class="str">&quot;-ggdb&quot;</span><span class="pln"> FEATURES</span><span class="pun">=</span><span class="str">&quot;noclean&quot;</span><span class="pln"> emerge</span><span class="pun">-</span><span class="pln">$</span><span class="pun">{</span><span class="pln">BOARD</span><span class="pun">}</span><span class="pln"> </span><span class="pun">-</span><span class="pln">v sys</span><span class="pun">-</span><span class="pln">apps</span><span class="pun">/</span><span class="pln">mosys
$ cros deploy </span><span class="pun">--</span><span class="pln">board</span><span class="pun">=</span><span class="pln">$</span><span class="pun">{</span><span class="pln">BOARD</span><span class="pun">}</span><span class="pln"> $</span><span class="pun">{</span><span class="pln">IP</span><span class="pun">}</span><span class="pln"> sys</span><span class="pun">-</span><span class="pln">apps</span><span class="pun">/</span><span class="pln">mosys
$ gdb</span><span class="pun">-</span><span class="pln">$</span><span class="pun">{</span><span class="pln">BOARD</span><span class="pun">}</span><span class="pln"> </span><span class="pun">--</span><span class="pln">cgdb </span><span class="pun">--</span><span class="pln">remote </span><span class="str">&quot;${IP}&quot;</span><span class="pln"> \
  </span><span class="pun">-</span><span class="pln">g </span><span class="str">&quot;--eval-command=directory /build/${BOARD}/tmp/portage/sys-apps/mosys-9999/work/&quot;</span><span class="pln"> \
  </span><span class="pun">/</span><span class="pln">usr</span><span class="pun">/</span><span class="pln">sbin</span><span class="pun">/</span><span class="pln">mosys </span><span class="pun">-</span><span class="pln">V
</span></pre><p>This will build your package with debug symbols (assuming your package respects <code class="code">CFLAGS</code>). We need to use the <code class="code">noclean</code> feature so that we have access to the original sourcecode that was used to build the package. Some packages will generate build artifacts and have different directory structures then the tar/git repo. This ensures all the paths line up correctly and the source code can be located. Ideally we would use the <code class="code">installsources</code> feature, but we don&#39;t have support for the debugedit package (yet!). Portage by default will strip the symbols and install the debug symbols in <code class="code">/usr/lib/debug/</code>. <code class="code">gdb-${BOARD}</code> will handle setting up the correct debug symbol path. cros deploy will then update the rootfs on the DUT. We pass the work directory into <code class="code">gdb-${BOARD}</code> so that [cgdb] can display the sourcecode inline.</p><p>Quick primer on cgdb:</p><ul><li>ESC: moves to the source window.</li><li>i: moves from source window to gdb window.</li></ul><h3><a class="h" name="Examples-of-debugging-using-the-gdb_BOARD_script" href="#Examples-of-debugging-using-the-gdb_BOARD_script"><span></span></a><a class="h" name="examples-of-debugging-using-the-gdb_board_script" href="#examples-of-debugging-using-the-gdb_board_script"><span></span></a>Examples of debugging using the gdb-${BOARD} script.</h3><p>Below are three examples of using the board-specific gdb wrapper scripts to start up debugging sessions. The first two examples show connecting to a remote chromebook. The first one automatically finds the browser&lsquo;s running GPU process, attaches gdbserver to the running process, starts gdb on the desktop, and connects the local gdb to gdbserver. It also shows the user running the <code class="code">bt</code> (backtrace) command after gdb comes up. The second example shows the user specifying the pid of a process on the chromebook. Again the script attaches gdbserver to the process, starts gdb on the desktop, and connects the two. The third example shows the user connecting to the main browser process in ChromeOS running in a VM on the user&rsquo;s desktop. For debugging the VM, you can use either <code class="code">--remote=:vm:</code> or <code class="code">--remote=localhost:9222</code> (<code class="code">:vm:</code> gets translated into <code class="code">localhost:9222</code>).</p><p>Example 1:</p><pre class="code"><span class="pun">(</span><span class="pln">inside</span><span class="pun">)</span><span class="pln">
$ gdb</span><span class="pun">-</span><span class="pln">lumpy </span><span class="pun">--</span><span class="pln">remote</span><span class="pun">=</span><span class="lit">123.45</span><span class="pun">.</span><span class="lit">67.809</span><span class="pln"> </span><span class="pun">--</span><span class="pln">attach</span><span class="pun">=</span><span class="pln">gpu</span><span class="pun">-</span><span class="pln">process

</span><span class="lit">14</span><span class="pun">:</span><span class="lit">50</span><span class="pun">:</span><span class="lit">07</span><span class="pun">:</span><span class="pln"> INFO</span><span class="pun">:</span><span class="pln"> </span><span class="typ">RunCommand</span><span class="pun">:</span><span class="pln"> ping </span><span class="pun">-</span><span class="pln">c </span><span class="lit">1</span><span class="pln"> </span><span class="pun">-</span><span class="pln">w </span><span class="lit">20</span><span class="pln"> </span><span class="lit">123.45</span><span class="pun">.</span><span class="lit">67.809</span><span class="pln">
</span><span class="lit">14</span><span class="pun">:</span><span class="lit">50</span><span class="pun">:</span><span class="lit">09</span><span class="pun">:</span><span class="pln"> INFO</span><span class="pun">:</span><span class="pln"> </span><span class="typ">RunCommand</span><span class="pun">:</span><span class="pln"> file </span><span class="pun">/</span><span class="pln">build</span><span class="pun">/</span><span class="pln">lumpy</span><span class="pun">/</span><span class="pln">opt</span><span class="pun">/</span><span class="pln">google</span><span class="pun">/</span><span class="pln">chrome</span><span class="pun">/</span><span class="pln">chrome
</span><span class="lit">14</span><span class="pun">:</span><span class="lit">50</span><span class="pun">:</span><span class="lit">10</span><span class="pun">:</span><span class="pln"> INFO</span><span class="pun">:</span><span class="pln"> </span><span class="typ">RunCommand</span><span class="pun">:</span><span class="pln"> x86_64</span><span class="pun">-</span><span class="pln">cros</span><span class="pun">-</span><span class="pln">linux</span><span class="pun">-</span><span class="pln">gnu</span><span class="pun">-</span><span class="pln">gdb </span><span class="pun">--</span><span class="pln">quiet </span><span class="str">&#39;--eval-command=set sysroot /build/lumpy&#39;</span><span class="pln"> </span><span class="str">&#39;--eval-command=set solib-absolute-prefix /build/lumpy&#39;</span><span class="pln"> </span><span class="str">&#39;--eval-command=set solib-search-path /build/lumpy&#39;</span><span class="pln"> </span><span class="str">&#39;--eval-command=set debug-file-directory /build/lumpy/usr/lib/debug&#39;</span><span class="pln"> </span><span class="str">&#39;--eval-command=set prompt (lumpy-gdb) &#39;</span><span class="pln"> </span><span class="str">&#39;--eval-command=file /build/lumpy/opt/google/chrome/chrome&#39;</span><span class="pln"> </span><span class="str">&#39;--eval-command=target remote localhost:38080&#39;</span><span class="pln">
</span><span class="typ">Reading</span><span class="pln"> symbols </span><span class="kwd">from</span><span class="pln"> </span><span class="pun">/</span><span class="pln">build</span><span class="pun">/</span><span class="pln">lumpy</span><span class="pun">/</span><span class="pln">opt</span><span class="pun">/</span><span class="pln">google</span><span class="pun">/</span><span class="pln">chrome</span><span class="pun">/</span><span class="pln">chrome</span><span class="pun">...</span><span class="typ">Reading</span><span class="pln"> symbols </span><span class="kwd">from</span><span class="pun">/</span><span class="pln">build</span><span class="pun">/</span><span class="pln">lumpy</span><span class="pun">/</span><span class="pln">usr</span><span class="pun">/</span><span class="pln">lib</span><span class="pun">/</span><span class="pln">debug</span><span class="pun">/</span><span class="pln">opt</span><span class="pun">/</span><span class="pln">google</span><span class="pun">/</span><span class="pln">chrome</span><span class="pun">/</span><span class="pln">chrome</span><span class="pun">.</span><span class="pln">debug</span><span class="pun">...</span><span class="kwd">done</span><span class="pun">.</span><span class="pln">
</span><span class="pun">(</span><span class="pln">lumpy</span><span class="pun">-</span><span class="pln">gdb</span><span class="pun">)</span><span class="pln"> bt
</span><span class="com">#0  0x00007f301fad56ad in poll () at ../sysdeps/unix/syscall-template.S:81</span><span class="pln">
</span><span class="com">#1  0x00007f3020d5787c in g_main_context_poll (priority=2147483647, n_fds=3,   fds=0xdce10719840, timeout=-1, context=0xdce1070ddc0) at gmain.c:3584</span><span class="pln">
</span><span class="com">#2  g_main_context_iterate (context=context@entry=0xdce1070ddc0,block=block@entry=1, dispatch=dispatch@entry=1, self=&lt;optimized out&gt;)  at gmain.c:3285</span><span class="pln">
</span><span class="com">#3  0x00007f3020d5798c in g_main_context_iteration (context=0xdce1070ddc0may_block=1) at gmain.c:3351</span><span class="pln">
</span><span class="com">#4  0x00007f30226a4c1a in base::MessagePumpGlib::Run (this=0xdce10718580, delegate=&lt;optimized out&gt;) at ../../../../../chromeos-cache/distfiles/target/chrome-src-internal/src/base/message_loop/message_pump_glib.cc:309</span><span class="pln">
</span><span class="com">#5  0x00007f30226666ef in base::RunLoop::Run (this=this@entry=0x7fff72271af0) at ../../../../../chromeos-cache/distfiles/target/chrome-src-internal/src/base/run_loop.cc:55</span><span class="pln">
</span><span class="com">#6  0x00007f302264e165 in base::MessageLoop::Run (this=this@entry=0x7fff72271db0) at ../../../../../chromeos-cache/distfiles/target/chrome-src-internal/src/base/message_loop/message_loop.cc:307</span><span class="pln">
</span><span class="com">#7  0x00007f30266bc847 in content::GpuMain (parameters=...) at ../../../../../chromeos-cache/distfiles/target/chrome-src-internal/src/content/gpu/gpu_main.cc:365</span><span class="pln">
</span><span class="com">#8  0x00007f30225cedee in content::RunNamedProcessTypeMain (process_type=..., main_function_params=..., delegate=0x7fff72272380 at ../../../../../chromeos-cache/distfiles/target/chrome-src-internal/src/content/app/content_main_runner.cc:385</span><span class="pln">
</span><span class="com">#9  0x00007f30225cef3a in content::ContentMainRunnerImpl::Run (this=0xdce106fef50) at ../../../../../chromeos-cache/distfiles/target/chrome-src-internal/src/content/app/content_main_runner.cc:763</span><span class="pln">
</span><span class="com">#10 0x00007f30225cd551 in content::ContentMain (params=...) at ../../../../../chromeos-cache/distfiles/target/chrome-src-internal/src/content/app/content_main.cc:19</span><span class="pln">
</span><span class="com">#11 0x00007f3021fef02a in ChromeMain (argc=21, argv=0x7fff722724b8) at ../../../../../chromeos-cache/distfiles/target/chrome-src-internal/src/chrome/app/chrome_main.cc:66</span><span class="pln">
</span><span class="com">#12 0x00007f301fa0bf40 in __libc_start_main (main=0x7f3021fee760 &lt;main(int, char const**)&gt;, argc=21, argv=0x7fff722724b8, init=&lt;optimized out&gt;, fini=&lt;optimized out&gt;, rtld_fini=&lt;optimized out&gt;,stack_end=0x7fff722724a8) at libc-start.c:292</span><span class="pln">
</span><span class="com">#13 0x00007f3021feee95 in _start ()</span><span class="pln">
</span><span class="pun">(</span><span class="pln">lumpy</span><span class="pun">-</span><span class="pln">gdb</span><span class="pun">)</span><span class="pln">
</span></pre><p>Example 2:</p><pre class="code"><span class="pun">(</span><span class="pln">inside</span><span class="pun">)</span><span class="pln">
$ gdb</span><span class="pun">-</span><span class="pln">daisy </span><span class="pun">--</span><span class="pln">pid</span><span class="pun">=</span><span class="lit">626</span><span class="pln"> </span><span class="pun">--</span><span class="pln">remote</span><span class="pun">=</span><span class="lit">123.45</span><span class="pun">.</span><span class="lit">98.765</span><span class="pln">
</span><span class="lit">14</span><span class="pun">:</span><span class="lit">50</span><span class="pun">:</span><span class="lit">07</span><span class="pun">:</span><span class="pln"> INFO</span><span class="pun">:</span><span class="pln"> </span><span class="typ">RunCommand</span><span class="pun">:</span><span class="pln"> ping </span><span class="pun">-</span><span class="pln">c </span><span class="lit">1</span><span class="pln"> </span><span class="pun">-</span><span class="pln">w </span><span class="lit">20</span><span class="pln"> </span><span class="lit">123.45</span><span class="pun">.</span><span class="lit">98.765</span><span class="pln">
</span><span class="lit">14</span><span class="pun">:</span><span class="lit">50</span><span class="pun">:</span><span class="lit">09</span><span class="pun">:</span><span class="pln"> INFO</span><span class="pun">:</span><span class="pln"> </span><span class="typ">RunCommand</span><span class="pun">:</span><span class="pln"> file </span><span class="pun">/</span><span class="pln">build</span><span class="pun">/</span><span class="pln">daisy</span><span class="pun">/</span><span class="pln">usr</span><span class="pun">/</span><span class="pln">sbin</span><span class="pun">/</span><span class="pln">cryptohomed
</span><span class="lit">14</span><span class="pun">:</span><span class="lit">50</span><span class="pun">:</span><span class="lit">10</span><span class="pun">:</span><span class="pln"> INFO</span><span class="pun">:</span><span class="pln"> </span><span class="typ">RunCommand</span><span class="pun">:</span><span class="pln"> armv7a</span><span class="pun">-</span><span class="pln">cros</span><span class="pun">-</span><span class="pln">linux</span><span class="pun">-</span><span class="pln">gnueabi</span><span class="pun">-</span><span class="pln">gdb </span><span class="pun">--</span><span class="pln">quiet </span><span class="str">&#39;--eval-command=set sysroot /build/daisy&#39;</span><span class="pln"> </span><span class="str">&#39;--eval-command=set solib-absolute-prefix /build/daisy&#39;</span><span class="pln"> </span><span class="str">&#39;--eval-command=set solib-search-path /build/daisy&#39;</span><span class="pln"> </span><span class="str">&#39;--eval-command=set debug-file-directory /build/daisy/usr/lib/debug&#39;</span><span class="pln"> </span><span class="str">&#39;--eval-command=set prompt (daisy-gdb) &#39;</span><span class="pln"> </span><span class="str">&#39;--eval-command=file /build/daisy/usr/sbin/cryptohomed&#39;</span><span class="pln"> </span><span class="str">&#39;--eval-command=target remote localhost:38080&#39;</span><span class="pln">
</span><span class="typ">Reading</span><span class="pln"> symbols </span><span class="kwd">from</span><span class="pln"> </span><span class="pun">/</span><span class="pln">build</span><span class="pun">/</span><span class="pln">daisy</span><span class="pun">/</span><span class="pln">usr</span><span class="pun">/</span><span class="pln">sbin</span><span class="pun">/</span><span class="pln">cryptohomed</span><span class="pun">...</span><span class="typ">Reading</span><span class="pln"> symbols </span><span class="kwd">from</span><span class="pun">/</span><span class="pln">build</span><span class="pun">/</span><span class="pln">daisy</span><span class="pun">/</span><span class="pln">usr</span><span class="pun">/</span><span class="pln">lib</span><span class="pun">/</span><span class="pln">debug</span><span class="pun">/</span><span class="pln">usr</span><span class="pun">/</span><span class="pln">bin</span><span class="pun">/</span><span class="pln">cryptohomed</span><span class="pun">.</span><span class="pln">debug</span><span class="pun">...</span><span class="kwd">done</span><span class="pun">.</span><span class="pln">
</span><span class="pun">(</span><span class="pln">daisy</span><span class="pun">-</span><span class="pln">gdb</span><span class="pun">)</span><span class="pln">
</span></pre><p>Example 3:</p><pre class="code"><span class="pun">(</span><span class="pln">inside</span><span class="pun">)</span><span class="pln">
$ gdb</span><span class="pun">-</span><span class="pln">lumpy </span><span class="pun">--</span><span class="pln">remote</span><span class="pun">=:</span><span class="pln">vm</span><span class="pun">:</span><span class="pln"> </span><span class="pun">--</span><span class="pln">attach</span><span class="pun">=</span><span class="pln">browser
</span><span class="lit">15</span><span class="pun">:</span><span class="lit">18</span><span class="pun">:</span><span class="lit">28</span><span class="pun">:</span><span class="pln"> INFO</span><span class="pun">:</span><span class="pln"> </span><span class="typ">RunCommand</span><span class="pun">:</span><span class="pln"> ping </span><span class="pun">-</span><span class="pln">c </span><span class="lit">1</span><span class="pln"> </span><span class="pun">-</span><span class="pln">w </span><span class="lit">20</span><span class="pln"> localhost
</span><span class="lit">15</span><span class="pun">:</span><span class="lit">18</span><span class="pun">:</span><span class="lit">31</span><span class="pun">:</span><span class="pln"> INFO</span><span class="pun">:</span><span class="pln"> </span><span class="typ">RunCommand</span><span class="pun">:</span><span class="pln"> file </span><span class="pun">/</span><span class="pln">build</span><span class="pun">/</span><span class="pln">lumpy</span><span class="pun">/</span><span class="pln">opt</span><span class="pun">/</span><span class="pln">google</span><span class="pun">/</span><span class="pln">chrome</span><span class="pun">/</span><span class="pln">chrome
</span><span class="lit">15</span><span class="pun">:</span><span class="lit">18</span><span class="pun">:</span><span class="lit">33</span><span class="pun">:</span><span class="pln"> INFO</span><span class="pun">:</span><span class="pln"> </span><span class="typ">RunCommand</span><span class="pun">:</span><span class="pln"> x86_64</span><span class="pun">-</span><span class="pln">cros</span><span class="pun">-</span><span class="pln">linux</span><span class="pun">-</span><span class="pln">gnu</span><span class="pun">-</span><span class="pln">gdb </span><span class="pun">--</span><span class="pln">quiet </span><span class="str">&#39;--eval-command=setsysroot /build/lumpy&#39;</span><span class="pln"> </span><span class="str">&#39;--eval-command=set solib-absolute-prefix /build/lumpy&#39;</span><span class="pln"> </span><span class="str">&#39;--eval-command=set solib-search-path /build/lumpy&#39;</span><span class="pln"> </span><span class="str">&#39;--eval-command=set debug-file-directory /build/lumpy/usr/lib/debug&#39;</span><span class="pln"> </span><span class="str">&#39;--eval-command=set prompt (lumpy-gdb) &#39;</span><span class="pln"> </span><span class="str">&#39;--eval-command=file /build/lumpy/opt/google/chrome/chrome&#39;</span><span class="pln"> </span><span class="str">&#39;--eval-command=target remote localhost:48062&#39;</span><span class="pln">
</span><span class="typ">Reading</span><span class="pln"> symbols </span><span class="kwd">from</span><span class="pln"> </span><span class="pun">/</span><span class="pln">build</span><span class="pun">/</span><span class="pln">lumpy</span><span class="pun">/</span><span class="pln">opt</span><span class="pun">/</span><span class="pln">google</span><span class="pun">/</span><span class="pln">chrome</span><span class="pun">/</span><span class="pln">chrome</span><span class="pun">...</span><span class="typ">Reading</span><span class="pln"> symbols </span><span class="kwd">from</span><span class="pln"> </span><span class="pun">/</span><span class="pln">build</span><span class="pun">/</span><span class="pln">lumpy</span><span class="pun">/</span><span class="pln">usr</span><span class="pun">/</span><span class="pln">lib</span><span class="pun">/</span><span class="pln">debug</span><span class="pun">/</span><span class="pln">opt</span><span class="pun">/</span><span class="pln">google</span><span class="pun">/</span><span class="pln">chrome</span><span class="pun">/</span><span class="pln">chrome</span><span class="pun">.</span><span class="pln">debug</span><span class="pun">...</span><span class="kwd">done</span><span class="pun">.</span><span class="pln">
</span><span class="kwd">done</span><span class="pun">.</span><span class="pln">
</span><span class="typ">Remote</span><span class="pln"> debugging </span><span class="kwd">using</span><span class="pln"> localhost</span><span class="pun">:</span><span class="lit">48062</span><span class="pln">
</span><span class="pun">...</span><span class="pln">
</span><span class="pun">(</span><span class="pln">lumpy</span><span class="pun">-</span><span class="pln">gdb</span><span class="pun">)</span><span class="pln">
</span></pre><p>If you find problems with the board-specific gdb scripts, please file a bug (<a href="https://crbug.com/new">crbug.com/new</a>) and add &lsquo;build-toolchain&rsquo; as one of the labels in the bug.</p><h2><a class="h" name="Building-Chrome-for-Chromium-OS" href="#Building-Chrome-for-Chromium-OS"><span></span></a><a class="h" name="building-chrome-for-chromium-os" href="#building-chrome-for-chromium-os"><span></span></a>Building Chrome for Chromium OS</h2><p>See <a href="simple_chrome_workflow.md">Simple Chrome Workflow</a>.</p><h2><a class="h" name="Troubleshooting" href="#Troubleshooting"><span></span></a><a class="h" name="troubleshooting" href="#troubleshooting"><span></span></a>Troubleshooting</h2><h3><a class="h" name="I-lost-my-developer-tools-on-the-stateful-partition_can-I-get-them-back" href="#I-lost-my-developer-tools-on-the-stateful-partition_can-I-get-them-back"><span></span></a><a class="h" name="i-lost-my-developer-tools-on-the-stateful-partition_can-i-get-them-back" href="#i-lost-my-developer-tools-on-the-stateful-partition_can-i-get-them-back"><span></span></a>I lost my developer tools on the stateful partition, can I get them back?</h3><p>This happens sometimes because the security system likes to wipe out the stateful partition and a lot of developer tools are in /usr/local/bin. But all is not lost because there is a tool for updating the stateful partition from an image created by the auto-update part of the dev_server. Sadly, it is normally found in /usr/local so will have been lost too and you need to copy it over manually. This works for me:</p><pre class="code"><span class="pln">$ cd </span><span class="pun">/</span><span class="pln">tmp
$ scp me@myworkstation</span><span class="pun">:</span><span class="str">/path/</span><span class="pln">to</span><span class="pun">/</span><span class="pln">chromiumos</span><span class="pun">/</span><span class="pln">chroot</span><span class="pun">/</span><span class="pln">build</span><span class="pun">/</span><span class="pln">x86</span><span class="pun">-</span><span class="pln">whatever</span><span class="pun">/</span><span class="pln">usr</span><span class="pun">/</span><span class="pln">bin</span><span class="pun">/</span><span class="pln">stateful_update </span><span class="pun">.</span><span class="pln">
$ sudo sh stateful_update
$ sudo reboot
</span></pre><p>Note you can clobber the stateful partition (remove user accounts etc and force OOBE) as part of this process by using a flag:</p><pre class="code"><span class="pln">$ cd </span><span class="pun">/</span><span class="pln">tmp
$ scp me@myworkstation</span><span class="pun">:</span><span class="str">/path/</span><span class="pln">to</span><span class="pun">/</span><span class="pln">chromiumos</span><span class="pun">/</span><span class="pln">chroot</span><span class="pun">/</span><span class="pln">build</span><span class="pun">/</span><span class="pln">x86</span><span class="pun">-</span><span class="pln">whatever</span><span class="pun">/</span><span class="pln">usr</span><span class="pun">/</span><span class="pln">bin</span><span class="pun">/</span><span class="pln">stateful_update </span><span class="pun">.</span><span class="pln">
$ sudo sh stateful_update </span><span class="pun">--</span><span class="pln">stateful_change</span><span class="pun">=</span><span class="pln">clean
$ sudo reboot
</span></pre><h2><a class="h" name="Running-Tests" href="#Running-Tests"><span></span></a><a class="h" name="running-tests" href="#running-tests"><span></span></a>Running Tests</h2><p>Chromium OS integration (or &ldquo;functional&rdquo;) tests are written using the <a href="https://chromium.googlesource.com/chromiumos/platform/tast/">Tast</a> or <a href="https://autotest.github.io/">Autotest</a> frameworks.</p><h3><a class="h" name="Tast" href="#Tast"><span></span></a><a class="h" name="tast" href="#tast"><span></span></a>Tast</h3><p><a href="https://chromium.googlesource.com/chromiumos/platform/tast/">Tast</a> is a Go-based integration testing framework with a focus on speed, ease-of-use, and maintainability. Existing Autotest-based tests that run on the Chrome OS Commit Queue are being ported to Tast and decommissioned as of 2018 Q4. Please strongly consider using Tast when writing new integration tests (but be aware that not all functionality provided by Autotest is available in Tast; for example, tests that use multiple devices simultaneously when running are not currently supported).</p><p>Here are some starting points for learning more about Tast:</p><ul><li><a href="https://chromium.googlesource.com/chromiumos/platform/tast/+/HEAD/docs/quickstart.md">Tast Quickstart</a></li><li><a href="https://chromium.googlesource.com/chromiumos/platform/tast/+/HEAD/docs/running_tests.md">Tast: Running Tests</a></li><li><a href="https://chromium.googlesource.com/chromiumos/platform/tast/+/HEAD/docs/writing_tests.md">Tast: Writing Tests</a></li><li><a href="https://chromium.googlesource.com/chromiumos/platform/tast/+/HEAD/docs/overview.md">Tast Overview</a></li></ul><p>Please contact the public <a href="https://groups.google.com/a/chromium.org/forum/#!forum/tast-users">tast-users mailing list</a> if you have questions.</p><h3><a class="h" name="Autotest" href="#Autotest"><span></span></a><a class="h" name="autotest" href="#autotest"><span></span></a>Autotest</h3><p><a href="https://autotest.github.io/">Autotest</a> is a Python-based integration testing framework; the codebase is also responsible for managing the <a href="http://sites/chromeos/for-team-members/lab/lab-faq">Chrome OS lab</a> that is used for hardware testing. Chromium-OS-specific Autotest information is available in the <a href="https://chromium.googlesource.com/chromiumos/third_party/autotest/+/master/docs/user-doc.md">Autotest User Documentation</a>.</p><p>Additional Autotest documentation:</p><ul><li><a href="https://chromium.googlesource.com/chromiumos/third_party/autotest/+/master/docs/user-doc.md#Writing-and-developing-tests">Creating a new Autotest test</a></li><li><a href="https://sites.google.com/a/chromium.org/dev/chromium-os/testing/running-smoke-suite-on-a-vm-image">Running Autotest Smoke Suite On a VM Image</a></li><li><a href="https://chromium.googlesource.com/chromiumos/third_party/autotest/+/master/docs/user-doc.md#Q4_I-have-an-ebuild_what-tests-does-it-build">Seeing which Autotest tests are implemented by an ebuild</a></li></ul><h3><a class="h" name="Creating-a-normal-image-that-has-been-modified-for-test" href="#Creating-a-normal-image-that-has-been-modified-for-test"><span></span></a><a class="h" name="creating-a-normal-image-that-has-been-modified-for-test" href="#creating-a-normal-image-that-has-been-modified-for-test"><span></span></a>Creating a normal image that has been modified for test</h3><p>See <a href="https://chromium.googlesource.com/chromiumos/third_party/autotest/+/master/docs/user-doc.md#W4_Create-and-run-a-test_enabled-image-on-your-device">Creating an image that has been modified for test</a> for information about modifying a normal system image so that integration tests can be run on it.</p><h3><a class="h" name="Creating-a-VM-image-that-has-been-modified-for-test" href="#Creating-a-VM-image-that-has-been-modified-for-test"><span></span></a><a class="h" name="creating-a-vm-image-that-has-been-modified-for-test" href="#creating-a-vm-image-that-has-been-modified-for-test"><span></span></a>Creating a VM image that has been modified for test</h3><p>If you wish to produce a VM image instead, you should omit the --test flag to build_image and let <code class="code">./image_to_vm.sh</code> produce the test image:</p><pre class="code"><span class="pun">(</span><span class="pln">inside</span><span class="pun">)</span><span class="pln"> </span><span class="pun">./</span><span class="pln">image_to_vm</span><span class="pun">.</span><span class="pln">sh </span><span class="pun">--</span><span class="pln">board</span><span class="pun">=</span><span class="pln">$</span><span class="pun">{</span><span class="pln">BOARD</span><span class="pun">}</span><span class="str">` --test_image
</span></pre><p>Note: this difference between <code class="code">cros flash</code> and <code class="code">./image_to_vm.sh</code> arises because <code class="code">./image_to_vm.sh</code> does not yet support the <code class="code">--image_name</code> flag and by default looks for <code class="code">chromiumos_image.bin</code>. We expect this to change in the future.</p><p>Note that creating a test image will change the root password of the image to <strong><code class="code">test0000</code></strong>. The <code class="code">--test_image</code> flag causes the <code class="code">image_to_xxx commands</code> to make a copy of your <code class="code">chromiumos_image.bin</code> file called <code class="code">chromiumos_test_image.bin</code> (if that file doesn&#39;t already exist), modify that image for test, and use the test image as the source of the command.</p><p><strong>SIDE NOTES:</strong></p><ul><li>If the directory already has a file called <code class="code">chromiumos_test_image.bin</code>, that file is reused. That means that calling both cros flash and <code class="code">image_to_vm.sh</code> doesn&#39;t waste time by creating the test image twice.</li></ul><h3><a class="h" name="Creating-a-recovery-image-that-has-been-modified-for-test" href="#Creating-a-recovery-image-that-has-been-modified-for-test"><span></span></a><a class="h" name="creating-a-recovery-image-that-has-been-modified-for-test" href="#creating-a-recovery-image-that-has-been-modified-for-test"><span></span></a>Creating a recovery image that has been modified for test</h3><p>After building a test image using <code class="code">./build_image test</code> as described above, you may wish to encapsulate it within a recovery image:</p><pre class="code"><span class="pun">(</span><span class="pln">inside</span><span class="pun">)</span><span class="pln">
</span><span class="pun">./</span><span class="pln">mod_image_for_recovery</span><span class="pun">.</span><span class="pln">sh \
    </span><span class="pun">--</span><span class="pln">board</span><span class="pun">=</span><span class="pln">$</span><span class="pun">{</span><span class="pln">BOARD</span><span class="pun">}</span><span class="pln"> \
    </span><span class="pun">--</span><span class="pln">nominimize_image \
    </span><span class="pun">--</span><span class="pln">image </span><span class="pun">~</span><span class="str">/trunk/</span><span class="pln">src</span><span class="pun">/</span><span class="pln">build</span><span class="pun">/</span><span class="pln">images</span><span class="pun">/</span><span class="pln">$</span><span class="pun">{</span><span class="pln">BOARD</span><span class="pun">}/</span><span class="pln">latest</span><span class="pun">/</span><span class="pln">chromiumos_test_image</span><span class="pun">.</span><span class="pln">bin \
    </span><span class="pun">--</span><span class="pln">to </span><span class="pun">~</span><span class="str">/trunk/</span><span class="pln">src</span><span class="pun">/</span><span class="pln">build</span><span class="pun">/</span><span class="pln">images</span><span class="pun">/</span><span class="pln">$</span><span class="pun">{</span><span class="pln">BOARD</span><span class="pun">}/</span><span class="pln">latest</span><span class="pun">/</span><span class="pln">recovery_test_image</span><span class="pun">.</span><span class="pln">bin
</span></pre><p>If desired, you may specify a custom kernel with <code class="code">--kernel_image ${RECOVERY_KERNEL}</code>.</p><p>You can write this recovery image out to the USB device like so:</p><pre class="code"><span class="pun">(</span><span class="pln">inside</span><span class="pun">)</span><span class="pln">
cros flash usb</span><span class="pun">:</span><span class="com">// ~/trunk/src/build/images/${BOARD}/latest/recovery_test_image.bin</span><span class="pln">
</span></pre><p>Note that there are some <strong>downsides</strong> to this approach which you should keep in mind.</p><ul><li>Your USB image will be a recovery mode/test image, but the ordinary image in your directory will be a non-test image.</li><li>If you use devserver, this will serve the non-test image not the test-image.</li><li>This means a machine installed with a test-enabled USB image will update to a non-test-enabled one.</li></ul><h2><a class="h" name="Additional-information" href="#Additional-information"><span></span></a><a class="h" name="additional-information" href="#additional-information"><span></span></a>Additional information</h2><h3><a class="h" name="Toolchain-Compilers" href="#Toolchain-Compilers"><span></span></a><a class="h" name="toolchain-compilers" href="#toolchain-compilers"><span></span></a>Toolchain Compilers</h3><p>At any given time in the chroot, to see what cross-compiler version is the current default one, do:</p><ul><li>For ARM: <code class="code">armv7a-cros-linux-gnueabi-gcc -v</code></li><li>For x86: <code class="code">i686-pc-linux-gnu-gcc -v</code></li><li>For amd64: <code class="code">x86_64-cros-linux-gnu-gcc -v</code></li></ul><h3><a class="h" name="Developer-mode" href="#Developer-mode"><span></span></a><a class="h" name="developer-mode" href="#developer-mode"><span></span></a>Developer mode</h3><p>It can be confusing to figure out what &ldquo;developer mode&rdquo; means: Some parts of this document talk about switching your hardware to developer mode, while other parts talk about entering developer mode by running an image built with the <code class="code">--withdev</code> flag. For the most part, the two actions enable the same set of things (like the shell command in crosh). Thus, you can think of either action as enabling developer mode.</p><p>To provide some details:</p><ul><li>Putting your hardware into developer mode makes <code class="code">/bin/cros_boot_mode</code> print <code class="code">developer</code>. It also makes the file <code class="code">/mnt/stateful_partition/.developer_mode</code> appear.</li><li>Building with the <code class="code">--withdev</code> flag creates a file called <code class="code">/root/.dev_mode</code> (in addition to adding a whole bunch of useful developer tools to your stateful partition). The presence of the <code class="code">/root/.dev_mode</code> file enables developer mode and also prevents wiping of the stateful partition when you switch your hardware between developer mode and release mode.</li></ul><h3><a class="h" name="Attribution-requirements" href="#Attribution-requirements"><span></span></a><a class="h" name="attribution-requirements" href="#attribution-requirements"><span></span></a>Attribution requirements</h3><p>When you produce a Chromium OS image, you need to fulfill various attribution requirements of third party licenses. Currently, the images generated by a build don&#39;t do this for you automatically. You must modify <a href="https://chromium.googlesource.com/chromium/src/+/master/chrome/browser/resources/chromeos/about_os_credits.html">about_os_credits.html</a>.</p><h3><a class="h" name="Documentation-on-this-site" href="#Documentation-on-this-site"><span></span></a><a class="h" name="documentation-on-this-site" href="#documentation-on-this-site"><span></span></a>Documentation on this site</h3><p>You now understand the basics of building, running, modifying, and testing Chromium OS, but you&#39;ve still got a lot to learn. Here are links to a few other pages on the chromium.org site that you are likely to find helpful (somewhat ordered by relevance):</p><ul><li>The <a href="https://sites.google.com/a/chromium.org/dev/chromium-os/tips-and-tricks-for-chromium-os-developers">Tips And Tricks</a> page has a lot of useful information to help you optimize your workflow.</li><li>If you haven&#39;t read the page about the  <a href="https://sites.google.com/a/chromium.org/dev/chromium-os/how-tos-and-troubleshooting/using-the-dev-server">devserver</a>  already, read it now.</li><li>Learn about the Chromium OS <a href="https://sites.google.com/a/chromium.org/dev/chromium-os/developer-guide/directory-structure">directory structure</a>.</li><li><a href="https://sites.google.com/a/chromium.org/dev/chromium-os/how-tos-and-troubleshooting/developer-faq">The Chromium OS developer FAQ</a></li><li><a href="https://sites.google.com/a/chromium.org/dev/chromium-os/how-tos-and-troubleshooting/portage-build-faq">Chromium OS Portage Build FAQ</a> is useful for portage-specific questions.</li><li>If you have questions about the <code class="code">--noenable_rootfs_verification</code> option, you might find answers on this <a href="https://groups.google.com/a/chromium.org/group/chromium-os-dev/browse_thread/thread/967e783e27dd3a9d/0fa20a1547de2c77?lnk=gst">thread on chromium-os-dev</a>.</li><li><a href="https://sites.google.com/a/chromium.org/dev/chromium-os/testing/running-smoke-suite-on-a-vm-image">Running Smoke Suite on a VM Image</a> has good information about how to get up and running with autotest tests and VMs.</li><li><a href="https://sites.google.com/a/chromium.org/dev/chromium-os/how-tos-and-troubleshooting/debugging-tips">Debugging Tips</a> contains information about how to debug the Chromium browser on your Chromium OS device.</li><li><a href="https://sites.google.com/a/chromium.org/dev/chromium-os/how-tos-and-troubleshooting/working-on-a-branch">Working on a Branch</a> has tips for working on branches.</li><li><a href="https://sites.google.com/a/chromium.org/dev/chromium-os/how-tos-and-troubleshooting/git-server-side-information">Git server-side information</a> talks about adding new git repositories.</li><li>The <a href="https://sites.google.com/a/chromium.org/dev/chromium-os/gentoo-package-upgrade-process">Portage Package Upgrade Process</a> documents how our Portage packages can be upgraded when they fall out of date with respect to upstream.</li><li>The <a href="https://sites.google.com/a/chromium.org/dev/chromium-os/developer-guide/chromium-os-sandboxing">Chromium OS Sandboxing</a> page describes the mechanisms and tools used to sandbox (or otherwise restrict the privileges of) Chromium OS system services.</li><li>The <a href="https://sites.google.com/a/chromium.org/dev/chromium-os/developer-guide/go-in-chromium-os">Go in Chromium OS</a> page provides information on using <a href="http://golang.org">Go</a> in Chromium OS, including recommendations for project organization, importing and managing third party packages, and writing ebuilds.</li></ul><h3><a class="h" name="External-documentation" href="#External-documentation"><span></span></a><a class="h" name="external-documentation" href="#external-documentation"><span></span></a>External documentation</h3><p>Below are a few links to external sites that you might also find helpful (somewhat ordered by relevance):</p><ul><li><strong>Definitely</strong> look at the <a href="http://groups.google.com/a/chromium.org/group/chromium-os-dev">Chromium OS dev group</a> to see what people are talking about.</li><li>Check out the <a href="http://code.google.com/p/chromium-os/issues/list">Chromium OS bug tracker</a> to report bugs, look for known issues, or look for things to fix.</li><li>Get an idea of what&#39;s actively happening by looking at the <a href="https://chromium-review.googlesource.com/">Chromium Gerrit</a> site. (Note that this is no longer the same site that Chromium uses)</li><li>Browse the source code on the <a href="https://chromium.googlesource.com/">Chromium OS gitweb</a>.</li><li>Check the current status of the builds by looking at the <a href="http://build.chromium.org/p/chromiumos/waterfall">Chromium OS build waterfall</a>.</li><li>Check out the <a href="http://webchat.freenode.net/?channels=chromium-os">#chromium-os channel</a> on freenode.net (this is the IRC channel that Chromium OS developers like to hang out on).</li><li>If you&#39;re learning git, check out <a href="http://eagain.net/articles/git-for-computer-scientists/">Git for Computer Scientists</a>, <a href="http://www-cs-students.stanford.edu/~blynn/gitmagic/">Git Magic</a>, or the <a href="http://schacon.github.com/git/user-manual.html">Git Manual</a>.</li><li>Gentoo has several useful documentation resources<ul><li><a href="http://devmanual.gentoo.org/">Gentoo Development Guide</a> is a useful resource for Portage, which is the underlying packaging system we use.</li><li><a href="https://wiki.gentoo.org/wiki/Embedded_Handbook">Gentoo Embedded Handbook</a></li><li><a href="http://www.gentoo.org/proj/en/base/embedded/handbook/">Gentoo Cross Development Guide</a></li><li><a href="http://en.gentoo-wiki.com/wiki/Crossdev">Gentoo Wiki on Cross-Compiling</a></li><li><a href="http://www.gentoo.org/proj/en/qa/pms.xml">Gentoo Package Manager Specification</a></li></ul></li><li>The  <a href="https://source.android.com/source/using-repo">repo user docs</a>  might help you if you&#39;re curious about repo.</li><li>The  <a href="http://groups.google.com/group/repo-discuss">repo-discuss group</a>  is a good place to talk about repo.</li></ul></div></div></div><!-- default customFooter --><footer class="Site-footer"><div class="Footer"><span class="Footer-poweredBy">Powered by <a href="https://gerrit.googlesource.com/gitiles/">Gitiles</a>| <a href="https://policies.google.com/privacy">Privacy</a></span><div class="Footer-links"></div></div></footer><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-55762617-15', 'auto'); ga('send', 'pageview', {title: 'Chromium OS Developer Guide'});</script></body></html>